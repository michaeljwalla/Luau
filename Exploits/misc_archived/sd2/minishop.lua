--press f2 to show/hide me
--creates a small shop in the bottom-middle-left section of your screen
if game.CoreGui:FindFirstChild("Shop") then game.CoreGui.Shop:Destroy() end
if _G.shoptween then _G.shoptween:Disconnect() end
local lp = game.Players.LocalPlayer
local gears = require(game:GetService("ReplicatedStorage").Modules.Gear)
local gear = {}
local defcol = Color3.new(1/3,1/3,1/3)
function ownsgear(gear)
    return (lp.Character and lp.Character:FindFirstChild(gear)) or lp.Backpack:FindFirstChild(gear) ~= nil
end

local main = Instance.new("ScreenGui", game.CoreGui)
main.Name = "Shop"

local menu = Instance.new("Frame", main)
menu.Size = UDim2.new(0,300,0,225)
menu.Position = UDim2.new(0, 300,1,-225)
menu.BackgroundColor3 = defcol
local ncb = Instance.new("TextButton", menu)
ncb.BackgroundTransparency = 1
ncb.Size = UDim2.new(1,0,1,0)
ncb.Text = ""
local shopitems = Instance.new("Frame", menu)
shopitems.Size = UDim2.new(1,0,0.7,0)
shopitems.Position += UDim2.new(0,0,0.2,0)
shopitems.BackgroundColor3 = defcol
local namelabel = Instance.new("TextLabel", menu)
namelabel.Size = UDim2.new(1,0,0.1,0)
namelabel.Name = "touchAll"
namelabel.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
namelabel.Font = Enum.Font.SourceSans
namelabel.Text = "-"
namelabel.TextColor3 = Color3.new(1, 1, 1)
namelabel.TextSize = 24
namelabel.TextWrapped = true
namelabel.BorderSizePixel = 1
local costlabel = namelabel:Clone()
costlabel.Parent = menu
costlabel.Position += UDim2.new(0,0,0.1,0)
costlabel.Text = "-"
costlabel.TextColor = BrickColor.new("Bright yellow")
local buysell = Instance.new("TextButton", menu)
buysell.Size = UDim2.new(1,0,0.1,0)
buysell.Name = "touchAll"
buysell.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
buysell.Font = Enum.Font.SourceSans
buysell.Text = "Buy"
buysell.TextColor3 = Color3.new(1, 1, 1)
buysell.TextSize = 24
buysell.TextWrapped = true
buysell.BorderSizePixel = 1
buysell.Position = UDim2.new(0,0,0.9,0)
buysell.BackgroundColor3 = Color3.new(1/3,2/3,1/3)
for i,v in pairs(gears.orderedGear) do
    for a,x in pairs(gears.gears) do
        if x.Name == v then
            gear[i] = x
        end
    end
end
local t = tick()
local isqd = false
function makeitem(table, index)
    local new = Instance.new("ImageButton", shopitems)
    new.Size = UDim2.new(0,29,0,29)
    new.BackgroundColor3 = defcol
    new.Image = "rbxassetid://"..table.Image
    local iil = #shopitems:GetChildren()-1
    new.Position = UDim2.new(0,(iil%10)*30,0,(math.floor(iil/10)*30))
    new.MouseButton1Down:Connect(function()
        if isqd or tick()-t < 1 then return end
        namelabel.Text = table.Name
        costlabel.Text = table.Price.." Coins"
        if ownsgear(table.Name) then
            buysell.Text = "Trash "..namelabel.Text
            buysell.BackgroundColor3 = Color3.new(2/3,1/3,1/3)
        else do
            buysell.Text = "Buy "..namelabel.Text
            buysell.BackgroundColor3 = Color3.new(1/3,2/3,1/3)
        end 
        end
        buysell.Name = index
    end)
end
for i = 1, 33 do
makeitem(gear[i], i)
end
buysell.MouseButton1Down:Connect(function()
    if tick()-t < 1 or not lp.Character then return end
    local tool = lp.Character:FindFirstChildWhichIsA("Tool")
    if not tonumber(buysell.Name) or (tonumber(buysell.Name) and not gear[math.floor(tonumber(buysell.Name))]) then return end
    local index = math.floor(tonumber(buysell.Name))
    t = tick()
    buysell.BackgroundColor3 = Color3.new(1/3,1/3,2/3)
    if not ownsgear(namelabel.Text) and namelabel.Text ~= "Random Gear" then
        buysell.Text = "Purchasing..."
        game:GetService("ReplicatedStorage").Remotes.BuyItem:FireServer(index)
        local err = tick()
        while wait() and tick()-err < 5 and not ownsgear(namelabel.Text) do t = tick() end
        if tick()-err < 5 then
            buysell.Text = "Trash "..namelabel.Text
            buysell.BackgroundColor3 = Color3.new(2/3,1/3,1/3)
            if tool and tool:IsDescendantOf(game) then tool.Parent = lp.Backpack end
            tool = lp.Backpack:FindFirstChild(namelabel.Text)
        else do
           buysell.Text = "Buy "..namelabel.Text
           buysell.BackgroundColor3 = Color3.new(1/3,2/3,1/3) 
        end
        end
        t = tick()-1
        
    else if namelabel.Text ~= "Random Gear" then
        buysell.Text = "Removing..."
        game:GetService("ReplicatedStorage").Remotes.BuyItem:FireServer(index)
        local err = tick()
        while wait() and tick()-err < 5 and ownsgear(namelabel.Text) do t = tick() end
        if tick()-err < 5 then
            buysell.Text = "Buy "..namelabel.Text
            buysell.BackgroundColor3 = Color3.new(1/3,2/3,1/3)
            if tool and tool:IsDescendantOf(game) then tool.Parent = lp.Backpack end
            tool = lp.Backpack:FindFirstChild(namelabel.Text)
        else do
            buysell.Text = "Trash "..namelabel.Text
            buysell.BackgroundColor3 = Color3.new(2/3,1/3,1/3)
        end
        end
        t = tick()-1
    else do
        if tool and tool:IsDescendantOf(game) then tool.Parent = lp.Backpack end
        buysell.Text = "Purchasing..."
        game:GetService("ReplicatedStorage").Remotes.BuyItem:FireServer(index)
        local breakloop
        spawn(function() while not breakloop() and wait() do t = tick() end end)
        tool = lp.Backpack.ChildAdded:Wait()
        breakloop = true
        buysell.Text = "Buy "..namelabel.Text
        buysell.BackgroundColor3 = Color3.new(1/3,2/3,1/3)
        t = tick()-1
    end
    end
    end
    if tool and tool:IsDescendantOf(game) then
        tool.Parent = lp.Character
    end
end)

_G.shoptween = game:GetService("UserInputService").InputBegan:Connect(function(key,chat)
    if key.KeyCode == Enum.KeyCode.F2 and not chat then 
        if menu.Position == UDim2.new(0, 300,1,-225) then
            game:GetService("TweenService"):Create(menu, TweenInfo.new(0.3), {Position = UDim2.new(0, 300,1,0)}):Play()
        else if menu.Position == UDim2.new(0, 300,1,0) then
            game:GetService("TweenService"):Create(menu, TweenInfo.new(0.3), {Position = UDim2.new(0, 300,1,-225)}):Play()
        end
        end
    end 
end)
