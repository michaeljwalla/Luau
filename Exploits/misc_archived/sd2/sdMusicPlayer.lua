--my first version of a custom music script
--use remastered if you actually want to try it out, this one isnt good at all
function main()
    -- if bugged, change these values to try and fix it
    -- these optiona are also in the gui

    unload = false -- unload script
    clearSaves = false -- reset save files

    if unload then
        for i,v in pairs(game.ReplicatedStorage:GetChildren()) do
            if v.Name == "scriptSongStorage" then
                v:Destroy()
            end
        end
        for i,v in pairs(game.CoreGui:GetChildren()) do
            if v.Name == "MusicPlayerUi" then 
                v:Destroy()
            end
        end
        game.StarterGui:SetCore("SendNotification", {
            Title = "Success";
            Text = "Unloaded script";
            Duration = 5;
        })
        game.Players.awdawdawdawdadwwadadw:Destroy()
    end
    if clearSaves then
        pcall(delfile, "SD2MUSICFAVS.json")
        pcall(delfile, "SD2ADDEDAUDIOS.json")
        pcall(delfile, "SD2PRESETS.json")
        game.StarterGui:SetCore("SendNotification", {
            Title = "Success";
            Text = "Cleared save files";
            Duration = 5;
        })
    end

    local customs = {}
    local reload = false
    local HttpService = game:GetService("HttpService") --http service needed for parsing JSON files(file saves)

    if not isfile("SD2MUSICFAVS.json") then
        print('madefile')
        writefile("SD2MUSICFAVS.json", "[]")
    end

    lol = readfile("SD2MUSICFAVS.json")

    bool, response = pcall(function() HttpService:JSONDecode(lol) end)
    if not response then
        response = "no error"
    end
    if response:find("Can\'t") ~= nil then
        warn('bad syntax, recreating file')
        writefile("SD2MUSICFAVS.json", "[]")
        game.StarterGui:SetCore("SendNotification", {
            Title = "ERR: Parsing Error";
            Text = "JSON could not be read! Resetting favorites file...";
            Icon = "rbxthumb://type=Asset&id=8174562775&w=150&h=150";
            Duration = 5;
        })
    end

    if not isfile("SD2PRESETS.json") then
        print('madefile')
        writefile("SD2PRESETS.json", "[]")
    end

    lol = readfile("SD2PRESETS.json")

    bool, response = pcall(function() HttpService:JSONDecode(lol) end)
    if not response then
        response = "no error"
    end
    if response:find("Can\'t") ~= nil then
        warn('bad syntax, recreating file')
        writefile("SD2PRESETS.json", "[]")
        game.StarterGui:SetCore("SendNotification", {
            Title = "ERR: Parsing Error";
            Text = "JSON could not be read! Resetting presets file...";
            Icon = "rbxthumb://type=Asset&id=8174562775&w=150&h=150";
            Duration = 5;
        })
    end

    if not isfile("SD2ADDEDAUDIOS.json") then
        print('madefile')
        writefile("SD2ADDEDAUDIOS.json", "[]")
    end

    lol = readfile("SD2ADDEDAUDIOS.json")

    bool, response = pcall(function() HttpService:JSONDecode(lol) end)
    if not response then
        response = "no error"
    end
    if response:find("Can\'t") ~= nil then
        warn('bad syntax, recreating file')
        writefile("SD2ADDEDAUDIOS.json", "[]")
        game.StarterGui:SetCore("SendNotification", {
            Title = "ERR: Parsing Error";
            Text = "JSON could not be read! Resetting added audios...";
            Icon = "rbxthumb://type=Asset&id=8174562775&w=150&h=150";
            Duration = 5;
        })
    end

    --note to self, items[extraIndex] is the current song INSTANCE
    for i,v in pairs(game.ReplicatedStorage:GetChildren()) do
        if v.Name == "scriptSongStorage" then
            v:Destroy()
        end
    end
    for i,v in pairs(game.CoreGui:GetChildren()) do
        if v.Name == "MusicPlayerUi" then 
            v:Destroy()
        end
    end
    wait(0.5)

    function pauseall() 
        for i,v in pairs(game.ReplicatedStorage.scriptSongStorage:GetChildren()) do
            v:Pause()
        end
    end
    local scriptSongStorage = Instance.new("Folder", game.ReplicatedStorage)
    scriptSongStorage.Name = "scriptSongStorage"
    local bellGui = Instance.new("ScreenGui")
    bellGui.Name = "MusicPlayerUi"
    bellGui.Parent = game.CoreGui

    local display = Instance.new("ScreenGui")
    display.Parent = bellGui
    display.Name = "GameMusic"

    local buttons = Instance.new("ScreenGui")
    buttons.Parent = bellGui
    buttons.Name = "Buttons"

    local sidebar = Instance.new("ScreenGui", buttons)
    sidebar.Name = "sidebar"

    TextBox = Instance.new("TextButton")
    TextBox.BackgroundTransparency = 1
    TextBox.Parent = buttons
    TextBox.Name = "Switcher"
    TextBox.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    TextBox.Position = UDim2.new(.86, 0, 1, -25)
    TextBox.Size = UDim2.new(0, 250, 0, 20)
    TextBox.Font = Enum.Font.SourceSans
    TextBox.TextColor3 = Color3.new(1, 1, 1)
    TextBox.TextScaled = true
    TextBox.TextSize = 10
    TextBox.TextWrapped = true
    TextBox.Text = "Loading..."


    StatusBox = TextBox:Clone()
    StatusBox.Name = "Current Song"
    StatusBox.Parent = TextBox.Parent
    StatusBox.Position = UDim2.new(.8622, 0, 0.975, -25)
    StatusBox.Size = UDim2.new(0, 200, 0, 25)
    StatusBox.Text = ""
    StatusBox.TextSize = 14
    StatusBox.BackgroundTransparency = 1


    lTextBox = Instance.new("TextButton", buttons)
    lTextBox.Visible = false
    lTextBox.Parent = buttons
    lTextBox.Name = "Left"
    lTextBox.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    lTextBox.Position = UDim2.new(.86, 0, 1, -25)
    lTextBox.Size = UDim2.new(0, 25, 0, 25)
    lTextBox.Font = Enum.Font.SourceSans
    lTextBox.TextColor3 = Color3.new(1, 1, 1)
    lTextBox.TextScaled = true
    lTextBox.TextSize = 10
    lTextBox.TextWrapped = true
    lTextBox.Text = "<"

    rTextBox = lTextBox:Clone()
    rTextBox.Visible = false
    rTextBox.Parent = buttons
    rTextBox.Text = ">"
    rTextBox.Name = "Right"
    rTextBox.Position = UDim2.new(.955, 0, 1, -25)

    local expandBtn = Instance.new("TextButton", sidebar)
    expandBtn.Name = "Expander"
    expandBtn.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    expandBtn.Position = UDim2.new(1.9875, 0, 0.73, 0)
    expandBtn.Size = UDim2.new(0, 25, 0, 25)
    expandBtn.Font = Enum.Font.SourceSans
    expandBtn.Text = " << "
    expandBtn.TextColor3 = Color3.new(1, 1, 1)
    expandBtn.TextScaled = true
    expandBtn.TextSize = 14
    expandBtn.TextWrapped = true

    local background = Instance.new("Frame", sidebar)
    background.Name = "Background"
    background.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    background.Position = UDim2.new(1, 0, 0.73, 0)
    background.Size = UDim2.new(0, 358, 0, 200)

    local expanded = false

    expandBtn.MouseButton1Click:Connect(function()
        if not expanded then
            expanded = true
            expandBtn.Position = UDim2.new(0.8, 0, 0.73, 0)
            background.Position = UDim2.new(0.813, 0, 0.73, 0)
            for i,v in pairs(background:GetDescendants()) do
                if v.ClassName ~= "Folder" and v.ClassName ~= "ScreenGui" and v.Parent.Parent.Parent.Name ~= "Favorites" then
                    xs = v.Position.X.Scale - 1
                    xo = v.Position.X.Offset
                    ys = v.Position.Y.Scale
                    yo = v.Position.Y.Offset
                    v.Position = UDim2.new(xs,xo,ys,yo)
                end
            end
            
            expandBtn.Text = " >> "
        else do
            expanded = false
            expandBtn.Position = UDim2.new(0.9875, 0, 0.75, 0)
            background.Position = UDim2.new(1, 0, 0.75, 0)
            for i,v in pairs(background:GetDescendants()) do
                if v.ClassName ~= "ScreenGui" and  v.ClassName ~= "Folder" then
                    xs = v.Position.X.Scale + 1
                    xo = v.Position.X.Offset
                    ys = v.Position.Y.Scale
                    yo = v.Position.Y.Offset
                    v.Position = UDim2.new(xs,xo,ys,yo)
                end
            end
            for i,v in pairs(game.CoreGui.MusicPlayerUi.Buttons.sidebar.Background.Favorites.ScrollFrame.ScrollingFrame:GetChildren()) do
                xs = v.Position.X.Scale - 1
                xo = v.Position.X.Offset
                ys = v.Position.Y.Scale
                yo = v.Position.Y.Offset
                v.Position = UDim2.new(xs,xo,ys,yo)
            end
            expandBtn.Text = " << "
        end
        end
    end)


    local volGui = Instance.new("Folder", background)
    local upButton = Instance.new("TextButton", volGui)
    local downButton = Instance.new("TextButton", volGui)
    local volVisualizer = Instance.new("Folder", volGui)
    local volume = 0.5

    volGui.Name = "volume"
    upButton.Name = "Up"
    downButton.Name = "Down"
    volVisualizer.Name = "visualizer"

    upButton.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    upButton.Position = UDim2.new(1.943, 0, 0.757, 0)
    upButton.Size = UDim2.new(0, 20, 0, 20)
    upButton.Font = Enum.Font.SourceSans
    upButton.Text = " /\\"
    upButton.TextColor3 = Color3.new(1, 1, 1)
    upButton.TextScaled = true
    upButton.TextSize = 14
    upButton.TextWrapped = true



    downButton.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    downButton.Position = UDim2.new(1.943, 0, 0.9, 0)
    downButton.Size = UDim2.new(0, 20, 0, 20)
    downButton.Font = Enum.Font.SourceSans
    downButton.Text = " \\/"
    downButton.TextColor3 = Color3.new(1, 1, 1)
    downButton.TextScaled = true
    downButton.TextSize = 14
    downButton.TextWrapped = true

    local visualbg = Instance.new("Frame", volVisualizer)
    visualbg.Name = "background"
    visualbg.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    visualbg.Position = UDim2.new(1.913, 0, 0.758, 0)
    visualbg.Size = UDim2.new(0, 10, 0, 48)
    visualbg.ClipsDescendants = true

    local visualbar = Instance.new("TextLabel", visualbg)
    visualbar.Name = "moving bar"
    visualbar.BackgroundColor3 = Color3.new(0, 1, 0)
    visualbar.Position = UDim2.new(1, 0, 1, 0-(25*volume))
    visualbar.Size = UDim2.new(0, 10, 0, 50*(volume/2))
    visualbar.BorderSizePixel = 0
    visualbar.Text = ""

    local Search = Instance.new("Folder", background)
    Search.Name = "search"

    local searchLabel = Instance.new("TextLabel", Search)
    searchLabel.Name = "InputField"
    searchLabel.Text = "Search"
    searchLabel.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    searchLabel.Position = UDim2.new(1, 0, 0, 0)
    searchLabel.Size = UDim2.new(0, 120, 0, 20)
    searchLabel.Font = Enum.Font.SourceSans
    searchLabel.TextColor3 = Color3.new(1, 1, 1)
    searchLabel.TextScaled = true
    searchLabel.TextSize = 10
    searchLabel.TextWrapped = true

    local txtSearch = Instance.new("TextBox", Search)
    txtSearch.Name = "InputField"
    txtSearch.Text = "..."
    txtSearch.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    txtSearch.Position = UDim2.new(1, 0, 0.12, -5)
    txtSearch.Size = UDim2.new(0, 120, 0, 20)
    txtSearch.Font = Enum.Font.SourceSans
    txtSearch.TextColor3 = Color3.new(1, 1, 1)
    txtSearch.TextScaled = true
    txtSearch.TextSize = 14
    txtSearch.TextWrapped = true

    local scrollBounds = Instance.new("Frame", Search)
    scrollBounds.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    scrollBounds.Position = UDim2.new(1, 0, 0.2, 0)
    scrollBounds.Size = UDim2.new(0, 120, 0, 160)
    scrollBounds.ClipsDescendants = true

    local scroller = Instance.new("ScrollingFrame", scrollBounds)
    scroller.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    scroller.Position = UDim2.new(1,0,0,0)
    scroller.Size = UDim2.new(1, 0, 1, 0)
    scroller.ScrollBarThickness = 1

    local items = {}
    local extraIndex = 1
    place = 1

    function updateDisplay()
        if expanded then
            visualbar.Position = UDim2.new(0, 0, 1, 0-(25*volume))
            visualbar.Size = UDim2.new(0, 10, 0, 50*(volume/2))
        end
        if #game.ReplicatedStorage.scriptSongStorage:GetChildren() ~= items then
            items = {}
            for i,v in pairs(game.ReplicatedStorage.scriptSongStorage:GetChildren()) do
                table.insert(items, v)
            end
        end
        TextBox.Text = items[place].Name.." ("..tostring(place).."/"..tostring(#items)..")"
    end
    --updateDisplay()

    lTextBox.MouseButton1Click:Connect(function()
        place -= 1
        if place <= 0 then
            place = #items
            updateDisplay()
        else do
            updateDisplay()
        end
        end
    end)

    rTextBox.MouseButton1Click:Connect(function()
        place += 1
        if place > #items then
            place = 1
            updateDisplay()
        else do
            updateDisplay()
        end
        end
    end)

    currentSong = "None"
    paused = true
    playing = false
    TextBox.MouseButton1Click:Connect(function()
        if not paused then
            paused = true
            pauseall()
            if playing then
                for i,v in pairs(items) do
                    if place ~= extraIndex then
                        items[extraIndex]:Pause()
                        extraIndex = i
                        v:Play()
                        paused = false
                        currentSong = TextBox.Text
                        StatusBox.Text = "Playing: "..currentSong
                        v.Volume = volume
                    end
                end
            end
            if paused then
                StatusBox.Text = "Paused: "..currentSong
                --print("Paused: "..currentSong)
            end
        else do
            paused = false
            
            for i,v in pairs(items) do
                if place == i then
                    extraIndex = i
                    if currentSong == TextBox.Text then
                        v:Resume()
                        v.Volume = volume
                    else do
                        v:Play()
                        v.Volume = volume
                    end
                    end
                    playing = true
                    --print("Playing: "..v.Name)
                end
            end
            currentSong = TextBox.Text
            StatusBox.Text = "Playing: "..currentSong
        end
        end
    end)
    downButton.MouseButton1Click:Connect(function()
        if volume >= 0.1 then
            volume -= 0.1
            if items[extraIndex] ~= nil then
                items[extraIndex].Volume = volume
            end
        end
        updateDisplay()
    end)
    upButton.MouseButton1Click:Connect(function()
        if volume < 1.9 then
            volume += 0.1
            if items[extraIndex] ~= nil then
                items[extraIndex].Volume = volume
            end
        end
        updateDisplay()
    end)

    function addScrollerInstance(instance)
        local btn = Instance.new("TextButton", scroller)
        btn.Text = instance.Name
        btn.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
        btn.Position = UDim2.new(0, 0, 0, 0+(31*(#scroller:GetChildren() - 1)))
        btn.Size = UDim2.new(1, 0, 0, 30)
        btn.Font = Enum.Font.SourceSans
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.TextScaled = true
        btn.TextSize = 14
        btn.TextWrapped = true
        
        btn.MouseButton1Click:Connect(function()
            pauseall()
            paused = false
            for i,v in pairs(items) do
                if v.Name == instance.Name then
                    place = i
                    extraIndex = i
                    v:Play()
                    TextBox.Text = items[place].Name.." ("..tostring(place).."/"..tostring(#items)..")"
                    currentSong = TextBox.Text
                    StatusBox.Text = "Playing: "..currentSong
                    v.Volume = volume
                end
            end
        end)
    end
    txtSearch.FocusLost:Connect(function()
        for i,v in pairs(scroller:GetDescendants()) do
            v:Destroy()
        end
        local ctr = 0
        if txtSearch.Text == "" then
            txtSearch.Text = "..."
            for i,v in pairs(items) do
                addScrollerInstance(v)
                ctr += 1
            end
        else do
            for i,v in pairs(items) do
                if string.lower(v.Name):find(string.lower(txtSearch.Text)) ~= nil then
                    addScrollerInstance(v)
                    ctr += 1
                end
            end
        end
        end
        scroller.CanvasSize = UDim2.new(0,0,0,31*ctr)
        searchLabel.Text = "Search ("..ctr..")"
        if ctr == 0 then
            searchLabel.Text = "No audios found!"
        end
    end)
    function makeSongs(instance)
        if instance.Value ~= 0 and instance.Value ~= 647230093 and instance.Value ~= 513947600 and instance.Value ~= 324966217 then
            local new = Instance.new("Sound", scriptSongStorage)
            new.SoundId = "rbxassetid://"..tostring(instance.Value)
            new.Name = instance.Parent.Name..", "..instance.Parent.Parent.Name
            new.Looped = true
            table.insert(items, new)
        end
    end
    for i,v in pairs(game.ReplicatedStorage.Music:GetChildren()) do
        if v.ClassName == "Folder" then
            for a,b in pairs(v:GetDescendants()) do
                if b.Name == "Loop" then
                    makeSongs(b)
                end
            end
        end
    end

    local presets = Instance.new("Folder", background)
    presets.Name = "map presets"

    local mapAssign = Instance.new("TextLabel", presets)
    mapAssign.Text = "Presets"
    mapAssign.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    mapAssign.Position = UDim2.new(1.674, 0, 0, 0)
    mapAssign.Size = UDim2.new(0, 117, 0, 20)
    mapAssign.Font = Enum.Font.SourceSans
    mapAssign.TextColor3 = Color3.new(1, 1, 1)
    mapAssign.TextScaled = true
    mapAssign.TextSize = 14
    mapAssign.TextWrapped = true

    local presetWin = Instance.new("Frame", presets)
    presetWin.Name = "ScrollWindow"
    presetWin.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    presetWin.Position = UDim2.new(1.674, 0, 0.1, 0)
    presetWin.Size = UDim2.new(0, 117, 0, 80)
    presetWin.ClipsDescendants = true

    local presetScr = Instance.new("ScrollingFrame", presetWin)
    presetScr.Name = "Scroll"
    presetScr.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    presetScr.Position = UDim2.new(1, 0, 0, 0)
    presetScr.Size = UDim2.new(1, 0, 1, 0)
    presetScr.ScrollBarThickness = 1

    local maps = {}
    local songs = HttpService:JSONDecode(readfile("SD2PRESETS.json"))
    local songUpdate = true
    --function preset()


    local favs = {}

    local favorites = Instance.new("Folder", background)
    favorites.Name = "Favorites"

    local favLabel = Instance.new("TextLabel", favorites)
    favLabel.Text = "Favorites"
    favLabel.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    favLabel.Position = UDim2.new(1.337, 0, 0, 0)
    favLabel.Size = UDim2.new(0, 120, 0, 20)
    favLabel.Font = Enum.Font.SourceSans
    favLabel.TextColor3 = Color3.new(1, 1, 1)
    favLabel.TextScaled = true
    favLabel.TextSize = 14
    favLabel.TextWrapped = true

    local favScrollFrame = Instance.new("Frame", favorites)
    favScrollFrame.Name = "ScrollFrame"
    favScrollFrame.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    favScrollFrame.Position = UDim2.new(1.337, 0, 0.1, 0)
    favScrollFrame.Size = UDim2.new(0, 120, 0.7, 0)
    favScrollFrame.ClipsDescendants = true

    local favScroller = Instance.new("ScrollingFrame", favScrollFrame)
    favScroller.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    favScroller.Position = UDim2.new(1,0,0,0)
    favScroller.Size = UDim2.new(1, 0, 1, 0)
    favScroller.CanvasSize = UDim2.new(0, 0, 0, 0)
    favScroller.ScrollBarThickness = 1

    local addFav = Instance.new("TextButton", favorites)
    addFav.Text = "Add Song"
    addFav.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    addFav.Position = UDim2.new(1.337, 0, 0.8, 0)
    addFav.Size = UDim2.new(0, 120, 0, 20)
    addFav.Font = Enum.Font.SourceSans
    addFav.TextColor3 = Color3.new(1, 1, 1)
    addFav.TextScaled = true
    addFav.TextSize = 14
    addFav.TextWrapped = false

    local remFav = Instance.new("TextButton", favorites)
    remFav.Text = "Remove Song"
    remFav.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    remFav.Position = UDim2.new(1.337, 0, 0.9, 0)
    remFav.Size = UDim2.new(0, 120, 0, 20)
    remFav.Font = Enum.Font.SourceSans
    remFav.TextColor3 = Color3.new(1, 1, 1)
    remFav.TextScaled = true
    remFav.TextSize = 14
    remFav.TextWrapped = false

    addFav.MouseButton1Click:Connect(function()
        updateFavs(items[place])
    end)

    remFav.MouseButton1Click:Connect(function()
        for i,v in pairs(favs) do
            if items[place] == v then
                print(v)
                if tostring(v):find("CUSTOM: ") then
                    for c,d in pairs(customs) do
                        if v.SoundId == d then
                            table.remove(customs, c)
                            writefile("SD2ADDEDAUDIOS.json", HttpService:JSONEncode(customs))
                            place = 1
                            paused = true
                            if paused then
                                StatusBox.Text = "Paused: "..TextBox.Text
                            else do
                                StatusBox.Text = "Paused: "..TextBox.Text
                            end
                            end
                        end
                    end
                    for t,y in pairs(items) do
                        if tostring(y.SoundId) == tostring(v.SoundId) then
                            y:Destroy()
                        end
                    end
                end
                table.remove(favs, i)
                for a,b in pairs(favScroller:GetChildren()) do
                    if v.Name == b.Text then
                        b:Destroy()
                    end
                end
                for m,n in pairs(favScroller:GetChildren()) do
                    n.Position = UDim2.new(0, 0, 0, 0+(31*(m-1)))
                end
                
                local temp = {}
                for i,v in pairs(favs) do
                    table.insert(temp, v.SoundId)
                end
            writefile("SD2MUSICFAVS.json", HttpService:JSONEncode(temp))
            favScroller.CanvasSize = UDim2.new(0,0,0,31*#favs)
            favLabel.Text = "Favorites ("..tostring(#favs)..")"
            print(place)
            updateDisplay()
            if not paused then
                StatusBox.Text = "Playing: "..TextBox.Text
            else do 
                StatusBox.Text = "Paused: "..TextBox.Text
            end
            end
            end
        end
    end)


    function updateFavs(item)
        if item ~= nil then
            
            for i,v in pairs(favScroller:GetChildren()) do
                if v.Text == item.Name then
                    favLabel.Text = "Already added!"
                    return false
                end
            end
            
            
            table.insert(favs, item)
            
            --when unpacking list (reverse search) take id and do for(items) if id == v.Value
            local txtBtn = Instance.new("TextButton", favScroller)
            txtBtn.Text = item.Name
            txtBtn.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
            txtBtn.Position = UDim2.new(0, 0, 0, 0+(31*(#favScroller:GetChildren() - 1)))
            txtBtn.Size = UDim2.new(1, 0, 0, 30)
            txtBtn.Font = Enum.Font.SourceSans
            txtBtn.TextColor3 = Color3.new(1, 1, 1)
            txtBtn.TextScaled = true
            txtBtn.TextSize = 14
            txtBtn.TextWrapped = true

            txtBtn.MouseButton1Click:Connect(function()
                pauseall()
                paused = false
                playing = true
                for i,v in pairs(items) do
                    if v.Name == item.Name then
                        place = i
                        extraIndex = i
                        v:Play()
                        TextBox.Text = items[place].Name.." ("..tostring(place).."/"..tostring(#items)..")"
                        currentSong = TextBox.Text
                        StatusBox.Text = "Playing: "..currentSong
                        v.Volume = volume
                    end
                end
            end)
            
            local temp = {}
            for i,v in pairs(favs) do
                    table.insert(temp, v.SoundId)
            end
            writefile("SD2MUSICFAVS.json", HttpService:JSONEncode(temp))
        end
        favScroller.CanvasSize = UDim2.new(0,0,0,31*#favs)
        favLabel.Text = "Favorites ("..tostring(#favs)..")"
    end

    function loadfavs()
        favsloaded = true --um yeah it has to do this
        h = HttpService:JSONDecode(readfile("SD2MUSICFAVS.json"))
        for i,v in pairs(h) do
            for a,b in pairs(items) do
                if v == b.SoundId then
                    updateFavs(b)
                end
            end
        end
        
        h = HttpService:JSONDecode(readfile("SD2ADDEDAUDIOS.json"))
        --TextBox.Text = "1111Importing customs..."
        local duped = false
            ctr = 0
            for i,v in pairs(h) do
                if not duped then
                    local audio = Instance.new("Sound", game.ReplicatedStorage.scriptSongStorage)
                    audio.Name = "Custom"
                    audio.SoundId = v
                    --wait(0.5) -- might need to add back if audios start not loading properly
                    
                    local Asset
                    local id
                    if not duped then
                        id = audio.SoundId:match("%d+")
                        Asset = game:GetService("MarketplaceService"):GetProductInfo(id)
                        audio.Name = "CUSTOM: "..Asset.Name
                        table.insert(customs, audio.SoundId)
                        audio.Looped = true
                        table.insert(items, audio)
                        updateDisplay()
                        updateFavs(audio)
                        ctr += 1
                        TextBox.Text = "Importing: "..Asset.Name.. " ("..ctr.."/"..#h..")"
                    end
                    
                end
        end
        wait(0.1) --dramatic effect
        TextBox.Text = "Done!"
        wait(0.1) --ditto
    end

    local addId

    local found = false
    local curmap

    local userAudios = Instance.new("Folder", background)
    userAudios.Name = "user audios"

    local uaLabel = Instance.new("TextLabel", userAudios)
    uaLabel.Text = "Customize"
    uaLabel.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    uaLabel.Position = UDim2.new(1.675, 0, 0.5, 0)
    uaLabel.Size = UDim2.new(0.325, 0, 0, 20)
    uaLabel.Font = Enum.Font.SourceSans
    uaLabel.TextColor3 = Color3.new(1, 1, 1)
    uaLabel.TextScaled = true
    uaLabel.TextSize = 14
    uaLabel.TextWrapped = true

    local uaInput = Instance.new("TextBox", userAudios)
    uaInput.Text = "Enter Audio ID"
    uaInput.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    uaInput.Position = UDim2.new(1.675, 0, 0.6, 0)
    uaInput.Size = UDim2.new(0.325, 0, 0, 20)
    uaInput.Font = Enum.Font.SourceSans
    uaInput.TextColor3 = Color3.new(1, 1, 1)
    uaInput.TextScaled = true
    uaInput.TextSize = 14
    uaInput.TextWrapped = true

    local uaOutput = Instance.new("TextLabel", userAudios)
    uaOutput.Text = "--OUTPUT--"
    uaOutput.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    uaOutput.Position = UDim2.new(1.675, 0, 0.7, 0)
    uaOutput.Size = UDim2.new(0.325, 0, 0.06, 0)
    uaOutput.Font = Enum.Font.SourceSans
    uaOutput.TextColor3 = Color3.new(1, 1, 1)
    uaOutput.TextScaled = true
    uaOutput.TextSize = 14
    uaOutput.TextWrapped = true


    uaInput.FocusLost:Connect(function()
        local duped = false
        if tonumber(uaInput.Text) then
            for i,v in pairs(customs) do
                if uaInput.Text == v:gsub("rbxassetid://","") then
                    duped = true
                    uaOutput.Text = "Already loaded!"
                end
            end
            if not duped then
                local audio = Instance.new("Sound", game.ReplicatedStorage.scriptSongStorage)
                audio.Name = "Custom"
                audio.SoundId = "rbxassetid://"..tonumber(uaInput.Text)
                uaOutput.Text = "Adding Audio..."
                wait(0.5)
                
                local Asset
                local id
                if audio.IsLoaded then
                    id = audio.SoundId:match("%d+")
                    Asset = game:GetService("MarketplaceService"):GetProductInfo(id)
                    uaOutput.Text = "Loaded "..Asset.Name
                    audio.Name = "CUSTOM: "..Asset.Name
                    table.insert(customs, audio.SoundId)
                    audio.Looped = true
                    table.insert(items, audio)
                    updateDisplay()
                    updateFavs(audio)
                    if not paused then
                        StatusBox.Text = "Playing: "..TextBox.Text
                    else do 
                        StatusBox.Text = "Paused: "..TextBox.Text
                    end
                    end
                else do
                    audio:Destroy()
                    uaOutput.Text = "Loading failed (try again?)"
                end
                end
                
            end
        else do
            uaInput.Text = "Enter Audio Id"
        end	
        end
        writefile("SD2ADDEDAUDIOS.json", HttpService:JSONEncode(customs))
    end)

    local misc = Instance.new("Folder", background)
    misc.Name = "Misc"

    local miscbar = Instance.new("TextLabel", misc)
    miscbar.Text = "Misc."
    miscbar.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
    miscbar.Position = UDim2.new(1.675, 0, 0.765, 0)
    miscbar.Size = UDim2.new(0.235, 0, 0.06, 0)
    miscbar.Font = Enum.Font.SourceSans
    miscbar.TextColor3 = Color3.new(1, 1, 1)
    miscbar.TextScaled = true
    miscbar.TextSize = 14
    miscbar.TextWrapped = true

    local unloader = Instance.new("TextButton", misc)
    unloader.Text = "Unload Script"
    unloader.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    unloader.Position = UDim2.new(1.675, 0, 0.830, 0)
    unloader.Size = UDim2.new(0.235, 0, 0.06, 0)
    unloader.Font = Enum.Font.SourceSans
    unloader.TextColor3 = Color3.new(1, 1, 1)
    unloader.TextScaled = true
    unloader.TextSize = 14
    unloader.TextWrapped = true

    clicked = 0
    unloader.MouseButton1Click:Connect(function()
        clicked += 1
        if clicked == 1 then
            unloader.Text = "Confirm?"
            wait(3)
            if clicked == 1 then
                clicked = 0
                unloader.Text = "Unload Script"
            end
        else if clicked > 1 then
            for i,v in pairs(game.ReplicatedStorage:GetChildren()) do
                if v.Name == "scriptSongStorage" then
                    v:Destroy()
                end
            end
            for i,v in pairs(game.CoreGui:GetChildren()) do
                if v.Name == "MusicPlayerUi" then 
                    v:Destroy()
                end
            end
            game.StarterGui:SetCore("SendNotification", {
                Title = "Success";
                Text = "Unloaded script";
                Duration = 3;
            })
        end
        end
    end)

    local delSaves = Instance.new("TextButton", misc)
    delSaves.Text = "Delete Saves"
    delSaves.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    delSaves.Position = UDim2.new(1.675, 0, 0.895, 0)
    delSaves.Size = UDim2.new(0.235, 0, 0.06, 0)
    delSaves.Font = Enum.Font.SourceSans
    delSaves.TextColor3 = Color3.new(1, 1, 1)
    delSaves.TextScaled = true
    delSaves.TextSize = 14
    delSaves.TextWrapped = true

    local delConfirm = Instance.new("TextBox", misc)
    delConfirm.Text = "- - - - -"
    delConfirm.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
    delConfirm.Position = UDim2.new(1.675, 0, 0.96, 0)
    delConfirm.Size = UDim2.new(0.235, 0, 0.04, 0)
    delConfirm.Font = Enum.Font.SourceSans
    delConfirm.TextColor3 = Color3.new(1, 1, 1)
    delConfirm.TextScaled = true
    delConfirm.TextSize = 14
    delConfirm.TextWrapped = true

    delConfirm.FocusLost:Connect(function()
        if string.upper(delConfirm.Text) ~= "CONFIRM" then
            delConfirm.Text = "- - - - -"
        end
    end)

    delSaves.MouseButton1Down:Connect(function()
        if string.upper(delConfirm.Text) ~= "CONFIRM" then
            delSaves.Text = "Enter Confirm"
            wait(3)
        else do
            if string.upper(delConfirm.Text) == "CONFIRM" then
                reload = true
                pcall(delfile, "SD2MUSICFAVS.json")
                pcall(delfile, "SD2ADDEDAUDIOS.json")
                pcall(delfile, "SD2PRESETS.json")
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Success";
                    Text = "Cleared save files";
                    Duration = 3;
                })
            
                for i,v in pairs(game.ReplicatedStorage:GetChildren()) do
                    if v.Name == "scriptSongStorage" then
                        v:Destroy()
                    end
                end

                for i,v in pairs(game.CoreGui:GetChildren()) do
                    if v.Name == "MusicPlayerUi" then 
                        v:Destroy()
                    end
                end
                game.StarterGui:SetCore("SendNotification", {
                    Title = "Loading...";
                    Text = "Reloading script";
                    Duration = 3;
                })
            end
        end
        end
        if delSaves.Text == "Enter Confirm" then
            delSaves.Text = "Delete Saves"
        end
    end)
    function loadImports()
        TextBox.Text = "Importing audios, please wait"
        local tempDupes = HttpService:JSONDecode(readfile("SD2MUSICFAVS.json"))
        for i,v in pairs(tempDupes) do
            local duped = false
            for a,x in pairs(customs) do
                if v == x then
                    duped = true
                end
            end
            if not duped then
                table.insert(customs,v)
            end
        end

        for i,v in pairs(customs) do
            local audio = Instance.new("Sound", game.ReplicatedStorage.scriptSongStorage)
            audio.Name = "Custom"
            audio.SoundId = tostring(v)
            table.insert(items, audio)

        
            for i,v in pairs(items) do
                --print (v.IsLoaded)
                if v.Name == "Custom" then
                    local id = v.SoundId:match("%d+")
                    local Asset = game:GetService("MarketplaceService"):GetProductInfo(id)
                    v.Name = "CUSTOM: "..Asset.Name
                    v.Looped = true
                    updateFavs(audio)
                    print(#favs)
                end
            end
        end
        updateDisplay()
    end

    --loadImports()
    favsloaded = true
    loadfavs()
    if not favsloaded then
        loadfavs()
    end

    TextBox.Position = UDim2.new(.875, 0, 1, -25)
    TextBox.Size = UDim2.new(0, 150, 0, 25)

    TextBox.BackgroundTransparency = 0
    rTextBox.Visible = true
    lTextBox.Visible = true
    print('\n\nloaded '..#favs..' favorites\nloaded presets\nloaded '..#h..' custom audios\n')
    print()


    updateFavs()

        
    updateDisplay()
    for i,v in pairs(game.ReplicatedStorage.Maps:GetChildren()) do
        table.insert(maps, i, v.Name)
        
        local mapAssign = Instance.new("TextLabel", presetScr)
        mapAssign.Name = v.Name
        mapAssign.Text = v.Name
        mapAssign.BackgroundColor3 = Color3.new(0.25, 0.25, 0.25)
        mapAssign.Position = UDim2.new(1, 0, 0, 0+(150*(#maps-1)))
        mapAssign.Size = UDim2.new(1, 0, 0, 30)
        mapAssign.Font = Enum.Font.SourceSans
        mapAssign.TextColor3 = Color3.new(1, 1, 1)
        mapAssign.TextScaled = true
        mapAssign.TextSize = 14
        mapAssign.TextWrapped = true
        
        local setTo = mapAssign:Clone()
        setTo.BackgroundColor3 = Color3.new(0.333333,0.333333,0.333333)
        setTo.Text = "None"
        for q,e in pairs(items) do
            if e.SoundId == songs[v.Name] then
                setTo.Text = e.Name
            end
        end
        setTo.Parent = mapAssign
        setTo.Position = UDim2.new(1, 0, 0, 30)
        setTo.Size = UDim2.new(1, 0, 0, 30)
        
        local setBtn = Instance.new("TextButton", mapAssign)
        setBtn.Text = "Add"
        setBtn.Position = UDim2.new(1, 0, 0, 60)
        setBtn.Size = UDim2.new(0.5, 0, 0, 20)
        setBtn.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
        setBtn.Font = Enum.Font.SourceSans
        setBtn.TextColor3 = Color3.new(1, 1, 1)
        setBtn.TextScaled = true
        setBtn.TextSize = 14
        setBtn.TextWrapped = true
        
        remBtn = Instance.new("TextButton", mapAssign)
        remBtn.Text = "Clear"
        remBtn.Position = UDim2.new(1.5, 0, 0, 60)
        remBtn.Size = UDim2.new(0.5, 0, 0, 20)
        remBtn.BackgroundColor3 = Color3.new(0.333333, 0.333333, 0.333333)
        remBtn.Font = Enum.Font.SourceSans
        remBtn.TextColor3 = Color3.new(1, 1, 1)
        remBtn.TextScaled = true
        remBtn.TextSize = 14
        remBtn.TextWrapped = true
        
        setBtn.MouseButton1Click:Connect(function()
            if setTo.Text ~= items[place].Name then
                songs[setBtn.Parent.Name] = items[place].SoundId
                setTo.Text = items[place].Name
                writefile("SD2PRESETS.json", HttpService:JSONEncode(songs))
                songUpdate = true
            end
        end)
        
        remBtn.MouseButton1Click:Connect(function()
            if setTo.Text ~= "None" then
                songs[setBtn.Parent.Name] = "None"
                setTo.Text = "None"
                writefile("SD2PRESETS.json", HttpService:JSONEncode(songs))
                songUpdate = true
            end
        end)
    end


    presetScr.CanvasSize = UDim2.new(0,110,0,150*(#maps)-70)
    expandBtn.Position = UDim2.new(0.9875, 0, 0.73, 0)
    --nothing below this while loop will run until UI is destroyed
    while game.CoreGui:FindFirstChild("MusicPlayerUi") do
        wait()
        for i,v in pairs(game.Workspace.Map:GetChildren()) do
            if v.Name ~= curMap and v.ClassName == "Model" then
                curMap = v.Name
                songUpdate = true
            end
            if songUpdate then
                for i,v in pairs(maps) do
                    if curMap == v then
                        if (songUpdate) then
                            for b,c in pairs(items) do
                                if c.IsPlaying and songs[curMap] ~= c.SoundId and songs[curMap] ~= nil then
                                    c:Pause()
                                end
                                if (songs[curMap] == c.SoundId) and (not c.IsPlaying or songUpdate) then
                                    paused = false
                                    playing = true
                                    c:Resume()
                                    found = true
                                    place = b
                                    extraIndex = b
                                    TextBox.Text = items[place].Name.." ("..tostring(place).."/"..tostring(#items)..")"
                                    currentSong = TextBox.Text
                                    StatusBox.Text = "Playing: "..currentSong
                                    c.Volume = volume
                                end
                                songUpdate = false
                            end
                        else if not found then
                            pauseall()
                        end
                        end
                    end
                end
            end
        end
    end

    print('inf loop stopped(preset loop)')
    if reload then
        wait(1)
        main()
        reload = false
    end
end
main()