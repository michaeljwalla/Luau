if _G.chatcallsult then for i,v in pairs(_G.chatcallsult) do v:Disconnect() end end
if _G.commands then for i,v in pairs(_G.commands) do if v.Stop then v.Stop() end end end
if not isfile("msglogs.txt") then writefile("msglogs.txt", "") end
_G.chatcallsult = {}
_G.commands = {}
local lp = game.Players.LocalPlayer
local permwhitelist = {game.Players.LocalPlayer.Name, "Vritant", "iFlightless", "cooolguy123457", "YerminatorStonks", "ExoplexX", "TVdustman"}
local whitelist = {"iloveclaire5"}
local args = {
	    [1] = "None",
	    [2] = "All"
	}
local mute = false
function say(msg)
	if mute then return end
	args[1] = msg
	game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(unpack(args))
end
function rss(text) --remove starting spaces
    if typeof(text) ~= "string" then return end
    while text:sub(1,1) == " " do
        text = text:sub(2,#text)
    end
    return text
end
function unmagic(str)
	if true then return str end
	local original = str
	local look = "[().%%?[^$-]"
	--str = string.gsub(str, "-", "- ")
	local tbl = {}
	for i = 1, #str do
		table.insert(tbl, str:sub(i,i))
	end
	for i,v in pairs(tbl) do
		if v:find(look) then
			--dumb percent making me do more work
			if (i ~= 1) and tbl[i] == "%" or tbl[i-1] ~= "%%" or (tbl[i-1] == "%%" and tbl[i-2] == "%%") then
				tbl[i] = "%"..v
			end
			
		end
	end
	str = ""
	for i,v in pairs(tbl) do
		str = str..v
	end
	return str, original
end
function touch(what)
	local plr = game.Players.LocalPlayer
	if not plr.Character then return end
	firetouchinterest(plr.Character.HumanoidRootPart, what, 0)
	firetouchinterest(plr.Character.HumanoidRootPart, what, 1)
end
function findfirstalive(self: Instance)
	local alives = {}
	if not self or not typeof(self) == "Instance" then self = game.Workspace.Disaster end
	for i,v in pairs(self:GetDescendants()) do
		if game.Workspace.Effects:FindFirstChild("SpellCircle") then return false end --karma shield ðŸ˜Ÿ
		if v:IsA("Humanoid") and v.Parent:FindFirstChildWhichIsA("BasePart") and v.Health > 0 and lp.Character then
			table.insert(alives, {Par = v.Parent, Mag = (lp.Character.HumanoidRootPart.Position - v.Parent:FindFirstChildWhichIsA("BasePart").Position).Magnitude})
		end
	end
	if #alives < 1 then return false end
	local lowestmag = {Par = nil, Mag = math.huge}
	for i,v in pairs(alives) do
		if v.Mag < lowestmag.Mag then lowestmag = v end
	end
	return lowestmag.Par
end
function isWl(plr) --pass instance or string
	if typeof(plr) == "Instance" then
		plr = plr.Name
	else if type(plr) == "string" then
		task.wait()
	else do return false end
	end
	end
	local wl
	for i,v in pairs(whitelist) do
		if plr == v then return true end
	end
	return false
end

function isPermWl(plr)
	if typeof(plr) == "Instance" then
		plr = plr.Name
	else if type(plr) == "string" then
		task.wait()
	else do return false end
	end
	end
	local wl
	for i,v in pairs(permwhitelist) do
		if plr == v then return true end
	end
	return false
end
_G.commands.to = {Params = true, Func = function(name)
		if true then say("too sus") return end
		lp.Character.Humanoid.Jump = true
		local player
		for i,v in pairs(game.Players:GetPlayers()) do
			if string.lower(v.Name):find(string.lower(name)) == 1 and v ~= lp then
				player = v
				break
			end
		end
		if not player then return end
		lp.Character.Humanoid.Jump = false
		while lp.Character and not lp.Character.Humanoid.Jump do
			task.wait()
			if player.Character then
				lp.Character.Humanoid.Sit = true
				lp.Character.HumanoidRootPart.Velocity = Vector3.new(0,0,0)
				lp.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame*CFrame.Angles(0,math.rad(math.random(0,360)),0) + player.Character.HumanoidRootPart.CFrame.LookVector*5 - Vector3.new(0,2.48,0)
			end
		end
	end, Return = "Needs player"}
_G.commands.leave = {Params = true, Func = function(who, plr)
		if plr.Name == "FragileSilence" then say("mikey no permsðŸ˜¢ðŸ˜¢ðŸ˜¢ðŸ˜¢ðŸ¤¡ðŸ¤¡") return end
		if string.lower(game.Players.LocalPlayer.Name):find(string.lower(who)) ~= 1 then return end
		say("bye bye")
		wait(1)
		game:Shutdown()
	end, Return = "(username)"}
_G.commands.heal = {Params = false, Connection = nil, Func = function(opt) --optional on/off
		if true then say("doesnt work anymore") return end
		self = _G.commands.heal
		if not opt or opt == "on" then
			if self.Connection then return end
			self.Connection = game.Workspace.Effects.ChildAdded:Connect(function(v)
				if v.Name ~= "Projectile" then return end
				local h
				h = game.RunService.RenderStepped:Connect(function()
					if not v.Parent then h:Disconnect() end
					if game.Players.LocalPlayer.Character then touch(v) end
				end)
			end)
			say("heal on")
		else if opt == "off" then
			if self.Connection then self.Connection:Disconnect() self.Connection = nil say("heal off") end
		end
		end
	end, Stop = function() self = _G.commands.heal if self.Connection then self.Connection:Disconnect() self.Connection = nil return print('ended') end end}
_G.commands.light = {Params = false, Connection = nil, Func = function(opt) --optional on/off
		if true then say("doesnt work anymore") return end
		self = _G.commands.light
		if not opt or opt == "on" then
			if self.Connection then return end
			self.Connection = game.Workspace.ChildAdded:Connect(function(v)
				if v.Name ~= "Projectile" then return end
				if v:IsA("Part") and v.BrickColor == BrickColor.new("Pink") then
					local ffa = findfirstalive()
					if ffa and ffa:FindFirstChildWhichIsA("BasePart") then
						while wait() do
							if ffa:FindFirstChildWhichIsA("Humanoid").Health == 0 then ffa = findfirstalive() end
							if not findfirstalive() then break end
							if not v.Parent then break end
							if not ffa.Parent then ffa = findfirstalive() break end
							v.CFrame = ffa:FindFirstChildWhichIsA("BasePart").CFrame + Vector3.new(math.random(-5,5),math.random(-5,5),math.random(-5,5))
						end
					end
				end
			end)
			say("lightning on")
		else if opt == "off" then
			if self.Connection then self.Connection:Disconnect() self.Connection = nil say("lightning off") end
		end
		end
	end, Stop = function() self = _G.commands.light if self.Connection then self.Connection:Disconnect() self.Connection = nil return print('ended') end end}
_G.commands.snipe = {Params = false, Func = function(opt, plr)
	if not isPermWl(plr) then say("temps cant run that rofl") return end
	if plr ~= game.Players.LocalPlayer and game.Workspace.Disaster:FindFirstChild("Press The Button") then return say("ðŸ¤¡") end
	if not opt then
		local count = 0
		for i,v in pairs(game.Workspace:GetDescendants()) do
			if v:IsA("TouchTransmitter") and v.Parent.Name ~= "SpawnLocation" then count += 1 touch(v.Parent) end
		end
		say(string.format("sniped %d", count))
	else if opt == "loot" then
		local count = 0
		for i,v in pairs(game.Workspace:GetChildren()) do
			if v.Name:find("Orb") or v.Name:find("Ring") and not v.Name:find("RingParticle") then
				touch(v) count += 1
			end
		end
		say(string.format("sniped %d", count))
	end
	end
end}
_G.commands.mute = {Params = false, Func = function() mute = true end}
_G.commands.unmute = {Params = false, Func = function() mute = false say("unmuted") end}
_G.commands.say = {Params = true, Func = function(msg, plr) say(msg) end, Return = "say needs an input you dumb useless rat"}
_G.commands.wl = {Params = true, 
	Func = function(msg, caller)
		if not isPermWl(caller) then say("ur not permanent") return end
		local plr
		for i,v in pairs(game.Players:GetPlayers()) do
			if string.lower(v.Name):find(msg) == 1 then
				plr = v break
			end
		end
		if not plr then say("idk who that is bruh") return end
		if not isWl(plr) then table.insert(whitelist, plr.Name) say("whitelisted "..plr.Name) else do say(plr.Name.." is already whitelisted") end end
	end, Return = "(username)"}
_G.commands.bl = {Params = true, 
	Func = function(msg, caller) 
		if not isPermWl(caller) then say("ur not permanent") return end
		local plr
		for i,v in pairs(game.Players:GetPlayers()) do
			if string.lower(v.Name):find(msg) == 1 then
				plr = v break
			end
		end
		if not plr then say("idk who that is bruh") return end
		if isPermWl(plr) then say(plr.Name.." is permanently whitelisted") return end
		if isWl(plr) then
			for i,v in pairs(whitelist) do
				if v == plr.Name then v = nil say("removed "..plr.Name) return end
			end
		else do
			say(plr.Name.." is not whitelisted")
		end
		end
	end, Return = "(username)"}
function runit(plr, msg)
	if not isWl(plr) and not isPermWl(plr) then return end
	msg = unmagic(msg)
	if msg:find("/w "..game.Players.LocalPlayer.Name) == 1 then msg = msg:sub(#game.Players.LocalPlayer.Name + 5, #msg) end
	msg = rss(msg)
	if msg:find("-") ~= 1 then return end
	msg = string.lower(msg)
	
	local space = msg:find(" ")
	if not space then space = #msg else do space -= 1 end end
	local command = msg:sub(2,space)
	local param = msg:sub(space+2, #msg)
	if param == "" then param = nil end
	
	for i,v in pairs(_G.commands) do
		if command == i then
			if v.Params and not param then
				say(string.format("%s: %s", command, v.Return)) return
			else do
				v.Func(param, plr)
				print('run it up')
			end
			end
		break
		end 
	end
	appendfile("msglogs.txt", string.format("%s  --  %s\n", plr.Name, msg))
	return false
end
table.insert(_G.chatcallsult, game.Players.PlayerAdded:Connect(function(plr)
	plr.Chatted:Connect(function(msg)
		runit(plr,msg)
	end)
end))
for i,plr in pairs(game.Players:GetPlayers()) do
	table.insert(_G.chatcallsult, plr.Chatted:Connect(function(msg)
		runit(plr,msg)
	end))
end
local vu = game:GetService("VirtualUser")
lp.Idled:connect(function()
	vu:CaptureController ()vu:ClickButton2(Vector2.new())
end)