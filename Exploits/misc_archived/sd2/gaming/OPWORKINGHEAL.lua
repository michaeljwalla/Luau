if _G.antisdafk then _G.antisdafk:Disconnect() end
_G.antisdafk = game.Players.LocalPlayer.PlayerGui.ChildAdded:Connect(function(v)
    if v.Name == 'QuestionGui' then
        local x = v:WaitForChild"Notice":WaitForChild"Question".Text
        local y = v.Notice:WaitForChild"TextBox"
        local z = v.Notice:WaitForChild"Close"
        local numbers = x:match"%d %+ %d":split" + "
        local sum = tonumber(numbers[1]) + tonumber(numbers[2])
        y.Text = tostring(sum)
        task.wait(6)
        firesignal(z.MouseButton1Down)
    end
end)

local lp = game.Players.LocalPlayer
assert(lp.Name ~= 'kangaroom_lester', 'phew')

local mainMan = "kangaroom_lester"
local focus = mainMan
local mode = 0 --0 is circle 1 is rand

local function getchar()
    return lp.Character and lp.Character:WaitForChild"Right Arm"
end
local function getRootOf(char)
    return game.Players:FindFirstChild(char) and game.Players[char].Character and game.Players[char].Character:FindFirstChild"HumanoidRootPart"
end
local skip = {'FireServer','Kick'}
local choose = "kangaroom_lester"
local function nothing() return end
local placeholder = {CFrame = CFrame.new(0,0,0), Velocity = Vector3.zero}
_G.lastpos = placeholder
local lp = game.Players.LocalPlayer
local mouse = lp.GetMouse(lp)
if not _G.old then
    _G.old = hookmetamethod(game, '__namecall', newcclosure(function(self, ...)
        local script, method = getcallingscript(), getnamecallmethod()
        if not checkcaller() and script.Name == '...' and table.find(skip,method) then
            return nothing()
        end
        return _G.old(self, ...)
    end))
end
if not _G.old2 then
    _G.old2 = hookmetamethod(mouse, '__index', newcclosure(function(self, index)
        local scr = getcallingscript()
        local part = _G.lastpos
        if index == 'Hit' and scr and scr.Parent.Name == 'Healing Staff' and part then
            local result = part.CFrame + part.Velocity*Vector3.new(1,0,1)
            return result
        end
        return _G.old2(self, index)
    end))
end

if _G.refocus then _G.refocus:Disconnect() end
if _G.refocus2 then _G.refocus2:Disconnect() end
if _G.refocus3 then _G.refocus3:Disconnect() end
local curbag = lp.Backpack
_G.toPos = Vector3.zero


local function randomVector()

		local flip1,flip2,flip3 = (math.random() < 0.5 and 1 or -1),(math.random() < 0.5 and 1 or -1),(math.random() < 0.5 and 1 or -1)

		return Vector3.new(math.random()*flip1,math.random()*flip2,math.random()*flip3)
end
local toRad = math.pi/180
local function getVectorChoice(x)
    if mode == 1 then
        return randomVector() * 25
    else
        return Vector3.new(math.sin(x*toRad),math.sin(x*toRad*5),math.cos(x*toRad)) * Vector3.new(15,2,15)
    end
end

local function update(val, go)
    local arm, toPos = getchar(), getRootOf(focus)
    local hs = lp.Character:FindFirstChild"Healing Staff" or lp.Backpack:FindFirstChild"Healing Staff"
    if not (hs and hs:FindFirstChild"Handle" and arm and toPos) then return end
    hs.Handle.Massless = true
    getsenv(hs:WaitForChild"LocalScript").SetAnimation = function() end
    hs.Parent = lp.Backpack
    local transpose = arm.Position - (toPos.Position +  getVectorChoice(val))
    _G.lastpos = toPos
    hs.GripPos = Vector3.new(-transpose.X,-transpose.Z,-transpose.Y)
    task.defer(function()
        hs.Parent = lp.Character
        if hs:FindFirstChild"Handle" and hs.Handle:FindFirstChild"Mesh" then hs.Handle.Mesh:Destroy() end
        if go then hs:Activate() end
    end)
end
_G.refocus = lp.CharacterAdded:Connect(function(v)
    v:WaitForChild"Animate".Disabled = true
end)
local t = tick()
local x = 0
local myTurn = false
_G.refocus2 = game.RunService.Heartbeat:Connect(function()
    if tick() - t < 0.05 then return end
    if not lp.Character then t = tick()  + 0.5 return end
    t = tick()
    update(x, myTurn)
    x = x + 5
end)
_G.refocus3 = game.RunService.RenderStepped:Connect(function()
    pcall(function() 
        game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(0,-50,0)
        game.Players.LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.zero
    end)
end)


if getgenv().sock then pcall(function() getgenv().sock:Close() end) end
task.wait(0.1)
getgenv().sock = syn.websocket.connect('ws://localhost:3000')

pcall(function() game.CoreGui.SocketControl:Destroy() end)
local lp = game.Players.LocalPlayer

local uis = game:GetService'UserInputService'
local container = Instance.new("ScreenGui", game.CoreGui)
container.Name = 'SocketControl'
local main = Instance.new("TextBox", container)
main.Size = UDim2.new(0,250,0,25)
main.BackgroundColor3 = Color3.new()
main.BorderSizePixel = 0
main.BackgroundTransparency = 0.5
main.TextColor3 = Color3.new(1,1,1)
main.Text = ''
main.Font = 'Gotham'
main.Position = UDim2.new(1,-250,0.5,-main.Size.Y.Offset/2)
main.TextSize = 18
main.Visible = false
local response = Instance.new("TextLabel", main)
response.Size = UDim2.new(1,0,0,100)
response.Position = UDim2.fromOffset(0,main.Size.Y.Offset)
response.BackgroundTransparency = 0.5
response.TextColor3 = Color3.new(1,1,1)
response.BorderSizePixel = 0
response.TextSize = 14
response.TextWrapped = true
response.Font = 'Gotham'
response.TextYAlignment = "Top"
response.Text = "--- Response ---"
if _G.focusLock then _G.focusLock:Disconnect() end
_G.focusLock = uis.InputEnded:Connect(function(key, focused)
    if (focused or key.KeyCode ~= Enum.KeyCode.BackSlash) then return end
    main.Visible = true
    main:CaptureFocus()
end)
main.FocusLost:Connect(function()
    main.Text = main.Text:gsub("^%s*", ""):gsub("%s*$","")
    xpcall(function()
        sock:Send(main.Text)
        main.Visible = false
    end, function(err)
        response.Text = err:gsub("^.*:%d+: ", "")
    end)
    
end)
local dc
dc = sock.OnMessage:Connect(function(msg)
    if not response:IsDescendantOf(game) then dc:Disconnect() return end
    response.Text = "--- Response ---\n\n"..msg.."\n\n"..os.date():match("%d*:%d*:%d*")
    main.Visible = true
    local new
    task.spawn(function()
        main.FocusLost:Wait()
        new = true
    end)
    task.delay(5,function()
        if not new and main.Visible and uis:GetFocusedTextBox() ~= main then main.Visible = false end
    end)
end)

local actual
actual = sock.OnMessage:Connect(function(msg)
    if msg == 'READY' then sock:Send("syncHeal") return end
    if msg:match"^BROADCAST: " then
        msg = msg:gsub("^BROADCAST: ", "")
    end
    if msg:match("^%. [%.%a0-9_]*") then
        local who = msg:match("[%.%a0-9_]*$"):lower()
        if who == '.' then focus = mainMan return end
        for i,v in pairs(game.Players:GetPlayers()) do
            if v ~= lp and v.Name:lower():find(who) == 1 then
                focus = v.Name
                break
            end
        end
    elseif msg:match("^mode %d") then
        local cmode = tonumber(({msg:match"^mode %d":gsub("mode ", "")})[1])
        if cmode <= 1 and cmode >= 0 then mode = cmode end
    elseif msg == 'Equip' and lp.Character and lp.Backpack:FindFirstChild"Healing Staff" then
        lp.Backpack['Healing Staff'].Parent = lp.Character
    elseif msg == 'Activate' and lp.Character then
        local tool = lp.Character:FindFirstChild"Healing Staff"
        if tool then tool:Activate() end
    elseif msg:match"Activate %d+" then
        if lp.Backpack:FindFirstChild'Healing Staff' then lp.Backpack['Healing Staff'].Parent = lp.Character end
        local tool = lp.Character:FindFirstChild"Healing Staff"
        if tool then 
            local time = tonumber(({msg:match"Activate %d+":gsub("Activate ", "")})[1])
            local t = tick()
            print("Activating for "..time.."s")
            
            local con
            con = game.RunService.Heartbeat:Connect(function()
                if not (tick() - t <= time and lp.Character and tool.Parent) then con:Disconnect() return end
                tool:Activate()
            end)
            
        end
    end
end)
if _G.nodislol then _G.nodislol:Disconnect() end
_G.nodislol = workspace.Map.DescendantAdded:Connect(function(v)
    if not v:IsA"BasePart" then return end
	while not (lp.Character) do wait() end
	local root = lp.Character:WaitForChild"HumanoidRootPart"
	if (root.Position - v.Position).Magnitude <= 40 then v.CanCollide = false end
end)
for i,v in pairs(workspace.Map:GetDescendants()) do
    (function(v)
        if not v:IsA"BasePart" then return end
    	if (Vector3.new(0,-50,0) - v.Position).Magnitude <= 40 then v.CanCollide = false end
    end)(v)
end
--workspace.Map:Destroy()
