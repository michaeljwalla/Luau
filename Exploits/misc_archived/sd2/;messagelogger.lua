local ran
if _G.clc then for i,v in pairs(_G.clc) do v:Disconnect() end ran = true end
_G.clc = {}
function getdate()
	local r = os.date("*t")
	return ("%02d-%02d-%02d_%02d;%02d;%02d"):format(r.day, r.month,r.year,r.hour,r.min,r.sec):match("^%d*%-%d*%-%d*")
end
function gettime()
    local r = os.date("*t")
	return ("%02d-%02d-%02d_%02d;%02d;%02d"):format(r.day, r.month,r.year,r.hour,r.min,r.sec):match("%d*;%d*;%d*$")
end
function getplacename()
    local safe, info = pcall(game:GetService("MarketplaceService").GetProductInfo, game:GetService("MarketplaceService"), game.PlaceId)
    return ((safe and info.Name) or "Unable to lookup name"), game.PlaceId
end
function logmsg(plr, txt)
    --in case i play at 12am and day restarts
    local filepath = "MessageLogger/"..getdate()..".log"
    if not isfile(filepath) then writefile(filepath, "* File created at "..gettime()) end
    appendfile(filepath, string.format("\n[%s]: %s   <%s at %s>", plr.DisplayName, txt, plr.Name, gettime()))
end
function logplr(plr)
    table.insert(_G.clc, plr.Chatted:Connect(function(msg) logmsg(plr, msg) end))
end
if not isfolder("MessageLogger") then makefolder("MessageLogger") end
local loadmessage = (not ran and "Script first loaded at ") or ("Script reloaded at ")
if not isfile("MessageLogger/"..getdate()..".log") then writefile("MessageLogger/"..getdate()..".log", "* File created at "..gettime()) else do appendfile("MessageLogger/"..getdate()..".log", "\n\n* "..loadmessage..gettime()) end end

local curgame = {getplacename()}
appendfile("MessageLogger/"..getdate()..".log", "\n* Current game: "..curgame[1].."\n* GameId: "..curgame[2].."\n")


for i,v in pairs(game.Players:GetPlayers()) do logplr(v) end
table.insert(_G.clc, game.Players.PlayerAdded:Connect(logplr))
table.insert(_G.clc, 
    game.Players.PlayerRemoving:Connect(function(plr)
        if plr ~= game.Players.LocalPlayer then 
            local filepath = "MessageLogger/"..getdate()..".log"
            if not isfile(filepath) then writefile(filepath, "* File created at "..gettime()) end
            appendfile(filepath, string.format("\n\n* %s (%s) left the game at %s", plr.DisplayName, plr.Name, gettime()))
            return 
        end
        local filepath = "MessageLogger/"..getdate()..".log"
        if not isfile(filepath) then writefile(filepath, "* File created at "..gettime()) end
        appendfile(filepath, string.format("\n\n* You (%s) left the game at %s", plr.Name, gettime()))
    end)
)
table.insert(_G.clc,
    game.Players.PlayerAdded:Connect(function(plr)
        local filepath = "MessageLogger/"..getdate()..".log"
        if not isfile(filepath) then writefile(filepath, "* File created at "..gettime()) end
        appendfile(filepath, string.format("\n\n* %s (%s) joined the game at %s", plr.DisplayName, plr.Name, gettime()))
    end)
)
