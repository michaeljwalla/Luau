print("\n\n\n\n\n\n-whole\nsearch whole message(defaults to starting)\n\n-from{player}}\nmessages from player\n\n-d\nsearch -from for display name instead of username\n\n\n\n\n\n")
if _G.altchat then for i,v in pairs(_G.altchat) do v:Disconnect() end end
local saved
if game.CoreGui:FindFirstChild("alt chat") then saved = game.CoreGui["alt chat"].MainMenu.ScrollingFrame:Clone() game.CoreGui["alt chat"]:Destroy() end
--[[local temppath = game.Players.LocalPlayer.PlayerGui.Chat.Frame.ChatBarParentFrame.Frame.BoxFrame.Frame
if temppath:FindFirstChild("ChatBar") then temppath.ChatBar:Destroy() end
temppath = nil
game.Players.LocalPlayer.PlayerGui.Chat.Frame.ChatBarParentFrame.Frame.BoxFrame.Frame.TextLabel.Text = "you've disabled chat :)"
]]
if not isfolder("Message dumps") then makefolder("Message dumps") end
_G.altchat = {}
local lp = game.Players.LocalPlayer
local mouse = lp:GetMouse()
local txts = game:GetService("TextService")
local mps = game:GetService("MarketplaceService")
local defaultbg = Color3.new(1/3,1/3,1/3)
local enabledbg = Color3.new(1/4,1/4,1/4)
local sui = Instance.new("ScreenGui", game.CoreGui)
sui.Name = "alt chat"
local ons = Instance.new("Frame",sui)
ons.Size = UDim2.new(1,0,1,0)
ons.BackgroundTransparency = 1
ons.Name = "EnabledOptions"
local mm = Instance.new("Frame", sui)
mm.Size = UDim2.new(0,200,0,200)
mm.Name = "MainMenu"
mm.BackgroundColor3 = defaultbg
mm.Position = UDim2.new(0.5,-200,0.5,-150)
local dragbar = Instance.new("TextLabel", mm)
dragbar.Size = UDim2.new(1,0,0,25)
dragbar.Position = UDim2.new(0,0,0,-25)
dragbar.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
dragbar.Name = "Top"
dragbar.Text = "    Chat"
dragbar.Font = Enum.Font.SourceSans
dragbar.TextColor3 = Color3.new(1, 1, 1)
dragbar.TextSize = 14
dragbar.TextXAlignment = "Left"
local questionbox = Instance.new("TextButton", dragbar)
questionbox.Name = "InfoButton"
questionbox.Size = UDim2.new(0,24,0,24)
questionbox.Position = UDim2.new(1,-25,0,0)
questionbox.Text = "< - >"
questionbox.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
questionbox.BorderSizePixel = 0
questionbox.TextColor3 = Color3.new(1,1,1)
questionbox.TextSize = 14
questionbox.Font = Enum.Font.SourceSans
function newtween(inst, speed, values)
	return game:GetService("TweenService"):Create(inst, TweenInfo.new(speed), values)
end
function unmagic(str)
	local original = str
	local look = "[().%%?[^$-]"
	--str = string.gsub(str, "-", "- ")
	local tbl = {}
	for i = 1, #str do
		table.insert(tbl, str:sub(i,i))
	end
	for i,v in pairs(tbl) do
		if v:find(look) then
			--dumb percent making me do more work
			if i == 1 or tbl[i] == "%" or tbl[i-1] ~= "%%" or (tbl[i-1] == "%%" and tbl[i-2] == "%%") then
				tbl[i] = "%"..v
			end
			
		end
	end
	str = ""
	for i,v in pairs(tbl) do
		str = str..v
	end
	return str, original
end
function draggable(inst,dragwhat)
	function mousePos()
		return {x = mouse.X, y = mouse.Y}
	end
	local start, curPos
	local movewithme
	inst.InputBegan:Connect(function(InputObject)
        if InputObject.UserInputType == Enum.UserInputType.MouseButton1 then
            movewithme = mouse.Button1Down:Connect(function()
	            inst.BackgroundColor3 = Color3.new(1/8,1/8,1/8)
	            start = mousePos()
	            while task.wait() and movewithme.Connected do
	            	curPos = mousePos()
	            	menuLast = mm.Position
	            	if curPos.x ~= start.x or curPos.y ~= start.y then
	            		dragwhat.Position = dragwhat.Position + UDim2.new(0,curPos.x - start.x,0, curPos.y - start.y)
	            		start = mousePos()
	            	end
	            end
	            inst.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
	        end)
        end
    end)
    local mouseConnection
	mouseConnection = mouse.Button1Up:Connect(function()
		if not inst or not inst.Parent then mouseConnection:Disconnect() else do
			start = mousePos()
			curPos = start
			pcall(function()movewithme:Disconnect()end)
		end end
	end)
end
function getdate()
	local r = os.date("*t")
	return ("%02d-%02d-%02d_%02d;%02d;%02d"):format(r.day, r.month,r.year,r.hour,r.min,r.sec)
end
questionbox.MouseButton1Down:Connect(function()
	if mm.Size == UDim2.new(0,200,0,200) then
		newtween(mm, 0.5, {Size = UDim2.new(0,500,0,500)}):Play()
	else do
		newtween(mm, 0.5, {Size = UDim2.new(0,200,0,200)}):Play()
	end
	end
end)
draggable(dragbar, mm)
local container = Instance.new("ScrollingFrame", mm)
container.Size = UDim2.new(1,0,1,0)
container.BackgroundTransparency = 1
container.ScrollBarThickness = 2
container.CanvasSize = UDim2.new(1,0,1,0)
container.ChildAdded:Connect(function()
	container.CanvasSize = UDim2.new(1,-5,0,25*#container:GetChildren())
	local diff = math.abs(container.CanvasPosition.Y - (container.CanvasSize.Y.Offset-mm.Size.Y.Offset))
	if diff <= 25 then
		container.CanvasPosition = Vector2.new(0,container.CanvasSize.Y.Offset-mm.Size.Y.Offset)
	end
end)
local filter = mm:Clone()
filter.Parent = sui
filter.Position = mm.Position - UDim2.new(0,250,0,0)
draggable(filter.Top, filter)
filter.Top.Text = "Filter"
filter.Top.InfoButton.Size += UDim2.new(0,1,0,1)
filter.Name = "Filter"
local query = Instance.new("TextBox", filter)
query.Size = UDim2.new(1,0,0,25)
query.PlaceholderText = "Search keywords or names"
query.Text = ""
query.TextTruncate = 1
query.BackgroundColor3 = enabledbg
query.Position = UDim2.new(0,0,1,0)
query.TextColor3 = Color3.new(1,1,1)
query.ZIndex = 0
filter.ScrollingFrame.ChildAdded:Connect(function()
	filter.ScrollingFrame.CanvasSize = UDim2.new(1,-5,0,25*#filter.ScrollingFrame:GetChildren())
	local diff = math.abs(filter.ScrollingFrame.CanvasPosition.Y - (filter.ScrollingFrame.CanvasSize.Y.Offset-filter.Size.Y.Offset))
	if diff <= 25 then
		filter.ScrollingFrame.CanvasPosition = Vector2.new(0,filter.ScrollingFrame.CanvasSize.Y.Offset-filter.Size.Y.Offset)
	end
end)

filter.Top.InfoButton.MouseButton1Down:Connect(function()
    filter.Position = UDim2.new(0,filter.AbsolutePosition.X,0,filter.AbsolutePosition.Y)
    mm.Position = UDim2.new(0,mm.AbsolutePosition.X,0,mm.AbsolutePosition.Y)
    local diff = filter.Position - mm.Position
    if filter.Size == UDim2.new(0,200,0,200) then
        filter.Parent = mm
        filter.Position = diff
        newtween(filter, 0.5, {
            Size = UDim2.new(0,25,0,0),
            Position = UDim2.new(0,-25,0,0)
        }):Play()
        newtween(query, 0.5, {Position = UDim2.new(0,0,1,-25)}):Play()
        else do
            filter.Parent = sui
            filter.Position = mm.Position + diff
            newtween(filter, 0.5, {
                Size = UDim2.new(0,200,0,200),
                Position = mm.Position - UDim2.new(0,250,0,0)
            }):Play()
            newtween(query, 0.5, {Position = UDim2.new(0,0,1,0)}):Play()
        end
    end
end)
query.ClearTextOnFocus = false

query.FocusLost:Connect(function()
    if query.Text:gsub(" ", "") == "" then return end
    local search = string.lower(unmagic(query.Text))
    
    local searchwholestring
    if search:find(" *%%%-whole") then searchwholestring = true search = search:gsub(" *%%%-whole", "") end
    
    local searchedplr = search:match(" *%%%-from{.*}?[%b{}]")
    local plronly = searchedplr and searchedplr:gsub("^ *%%%-from[{}]", ""):gsub("}.*", "")
    
    local displayname
    if search:find(" *%%%-d") then displayname = true search = search:gsub(" *%%%-d", "") end
    
    search = search:gsub(" *%%%-from{.*}","")
    local startlen = search:match("^%s*.") and #search:match("^%s*.") or 1
    local endlen  = search:match("%a%s+$") and #search:match("%a%s+$") or #search
    search = search:sub(startlen, (endlen > 0 and endlen-(#search-endlen)) or #search)
    
    filter.ScrollingFrame:ClearAllChildren()
    for i,v in pairs(container:GetChildren()) do
        local sender = v.Sender.Value:gsub("[()]", ""):split(" ")
        local message = v.Text:sub(10+#sender[1], #v.Text)
        local finder = string.lower(message):find(search)
        local namefinder = (not displayname and string.lower(sender[2]):find(plronly or "")) or (displayname and string.lower(sender[1]):find(plronly or ""))
        if 
            ((not searchwholestring and finder == 1) or (searchwholestring and finder ~= nil))
            and (not plronly or (plronly and namefinder == 1))
        then
             newchat({Name = sender[2], DisplayName = sender[1]}, message, v.Time.Value, true)
        end
    end
    --yea idk why it updates both
    dragbar.Text = string.format("Chat (%d)", #container:GetChildren())
    filter.Top.Text = string.format("Filter (%d)", #filter.ScrollingFrame:GetChildren())
end)
local message = Instance.new("TextButton")
message.Size = UDim2.new(1,0,0,25)
message.Text = "blank message"
message.TextTruncate = 1
message.TextXAlignment = "Left"
message.BackgroundColor3 = defaultbg
message.TextColor3 = Color3.new(1,1,1)
local dumpmsgs = message:Clone()
dumpmsgs.Parent = mm
dumpmsgs.Name = "Dump"
dumpmsgs.Text = "Log messages"
dumpmsgs.TextXAlignment = "Center"
dumpmsgs.TextYAlignment = "Center"
dumpmsgs.BackgroundColor3 = enabledbg
dumpmsgs.Position = UDim2.new(0,0,1,25)

local lastnotify = tick()-0.5
function notify(title, text, duration, icon)
	if tick()-lastnotify < 0.5 then return end
	lastnotify = tick()
	local options = {}
	if not title and text then return end
	options.Title = title
	options.Text = text
	if duration then options.Duration = duration else do options.Duration = 5 end end
	if icon then options.Icon = icon end
	game.StarterGui:SetCore("SendNotification", options)
end
local lastlogged = tick()-5
dumpmsgs.MouseButton1Down:Connect(function()
	if tick() - lastlogged < 5 then notify("Failed to log", string.format("Please wait %ds before attempting this", 5-math.floor(tick()-lastlogged))) return end
	lastlogged = tick()
	local log = ""
	for i,v in pairs(container:GetChildren()) do
		local name = v.Sender.Value:split(" ")[2] or "(Unknown)"
		log = log..string.format("%s {{%s}}\n", v.Text, name:sub(2, #name-1))
	end
	local safe, info = pcall(mps.GetProductInfo, mps, game.PlaceId)
	local filename = string.format("Message dumps/%s_%d_%s.log", (safe and info.Name:gsub("[/\\*:?\"<>|]", "")) or "Game", game.PlaceId, getdate())
	writefile(filename, log)
	notify("Success", "workspace/"..filename)
end)
local clearlogs = dumpmsgs:Clone()
clearlogs.Parent = mm
clearlogs.Position -= UDim2.new(0,0,0,25)
clearlogs.Name = "Clear logs"
clearlogs.Text = "Clear logs"

clearlogs.MouseButton1Down:Connect(function()
	container:ClearAllChildren()
	container.CanvasSize = UDim2.new(1,-5,1,0)
	notify("Success", "Cleared logs")
end)
local timestamp = Instance.new("NumberValue", message)
timestamp.Name = "Time"
local sentby = Instance.new("StringValue", message)
sentby.Name = "Sender"
local expmsg = mm:Clone()
expmsg.Name = "Expanded message"
expmsg:ClearAllChildren()
expmsg.Parent = mm
expmsg.Position = UDim2.new(1,50,0,0)
expmsg.Visible = false
expmsg.Size -= UDim2.new(0,0,0,40)
local contents = container:Clone()
contents.BackgroundColor3 = defaultbg
contents.BackgroundTransparency = 0
contents.Parent = expmsg
contents.Size = UDim2.new(1,0,0.5,0)
contents.CanvasSize = UDim2.new(1,-5,0,300)
contents.ScrollBarThickness = 3
contents.Name = "content"
local txtcontents = dragbar:Clone()
txtcontents.Name = "text"
txtcontents.Parent = contents
txtcontents.Position = UDim2.new(0,5,0,5)
txtcontents:ClearAllChildren()
txtcontents.Size = UDim2.new(1,-10,1,-10)
txtcontents.BackgroundColor3 = defaultbg
txtcontents.TextYAlignment = "Top"
txtcontents.TextWrapped = true
txtcontents.BorderSizePixel = 0
local sender = txtcontents:Clone()
sender.Parent = expmsg
sender.Size = UDim2.new(1,0,0,30)
sender.Position = UDim2.new(0,0,0.5,0)
sender.BorderSizePixel = 1
sender.TextXAlignment = "Center"
sender.TextYAlignment = "Center"
sender.Name = "Sender"
local timeago = sender:Clone()
timeago.Parent = expmsg
timeago.Name = "Time ago"
timeago.Position += UDim2.new(0,0,0,30)
timeago.Size = UDim2.new(1,0,0,25)
local copymsg = message:Clone()
copymsg.Parent = expmsg
copymsg.Position = timeago.Position + UDim2.new(0,0,0,25)
copymsg.TextXAlignment = "Center"
copymsg.TextYAlignment = "Center"
copymsg.Text = "Copy Message"
copymsg.MouseButton1Down:Connect(function()
	setclipboard(txtcontents.Text)
end)
local lastpressed
function update(txtbox)
	expmsg.content.text.Text = txtbox.Text:sub(5,#txtbox.Text)
	expmsg.Sender.Text = string.gsub(txtbox.Sender.Value, " ", "\n")
end
function newchat(plr,msg, sendtime, where) --last 2 options for filter
	local new = message:Clone()
	local container = not where and container or filter.ScrollingFrame
	new.Parent = container
	new.Position = UDim2.new(0,0,0,25*(#container:GetChildren()-1))
	new.Text = string.format("    [%s]:  %s", plr.DisplayName, msg)
	new.Time.Value = sendtime or tick()
	new.Sender.Value = plr.DisplayName.." ("..plr.Name..")"
	new.MouseButton1Down:Connect(function()
		expmsg.content.CanvasPosition = Vector2.new(0,0)
		if lastpressed ~= new then
			expmsg.Visible = true
			update(new)
			lastpressed = new
		else do
			expmsg.Visible = false
			lastpressed = nil
		end
		end
	end)
	dragbar.Text = string.format("Chat (%d)", #container:GetChildren())
end
if saved then
	for i,v in pairs(saved:GetChildren()) do
		v.Parent = container
		v.ZIndex = mm.ZIndex
		v.MouseButton1Down:Connect(function()
		if lastpressed ~= v then
			expmsg.Visible = true
			update(v)
			lastpressed = v
		else do
			expmsg.Visible = false
			lastpressed = nil
		end
		end
	end)
	end
	dragbar.Text = string.format("Chat (%d)", #container:GetChildren())
	saved = nil
end

for i,v in pairs(game.Players:GetPlayers()) do
	table.insert(_G.altchat,
	v.Chatted:Connect(function(msg)
		newchat(v, msg)
	end))
end
table.insert(_G.altchat, game.Players.PlayerAdded:Connect(function(v)
	table.insert(_G.altchat,
	v.Chatted:Connect(function(msg)
		newchat(v, msg)
	end))
end))
table.insert(_G.altchat, game:GetService("UserInputService").InputBegan:Connect(function(key,chatting)
	if key.KeyCode == Enum.KeyCode.BackSlash and not chatting then mm.Visible = not mm.Visible filter.Visible = mm.Visible end
end))
for i,v in pairs(mm:GetDescendants()) do
    if v:IsA("GuiObject") then v.ZIndex = 2 end
end
local thisscript = _G.altchat[1]
local updtime = tick()
while wait() and sui.Parent and thisscript.Connected do 
	if (tick()-updtime < 1) or not lastpressed or (lastpressed and not lastpressed:FindFirstChild("Time")) then continue end
	local domath = tick()-lastpressed.Time.Value
	local result = ""
	if domath < 60 then
		result = string.format("%ds ago", domath)
	else if domath < 3600 then
	    local m = (domath - (domath%60))/60
	    local s = domath % 60
		result = string.format("%dm %ds ago", m,s)
	else if domath >= 3600 then
	    local h = (domath - (domath % 3600))/3600
	    local m = ((domath - (domath%60)) - (domath - (domath % 3600)))/60
	    local s = domath % 60
		result = string.format("%dh %dm %ds ago", h,m,s)
	end
	end
	end
	expmsg["Time ago"].Text = result
end
