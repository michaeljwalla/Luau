--i dont remember what this does

local http = game:GetService("HttpService")
function json(tbl) return http:JSONEncode(tbl) end
local channel = "retarded if you think im gonna leave the webhook in"

function constructfield(tbl, color)
    local embedfields = {}
    for i,v in pairs(tbl) do
        local new = {}
        new.name = i
        new.value = v
        table.insert(embedfields, new)
    end
    local rettbl = {
        color = color or 21455,
        title = 'Resources',
        description = os.date(), --star treat image
        thumbnail = {url = 'https://tr.rbxcdn.com/70101a9db139b8e2b55e1c936d5c8a7d/50/50/Decal/Png'},
        fields = embedfields
    }
    return rettbl
end
local lp = game.Players.LocalPlayer
local getter = require(game.ReplicatedStorage.ClientStatCache)
local eggs = getter:Get('Eggs')

--too lazy to make genv data kept after reexecuting
local clone = setmetatable({}, {
    __pow = function(self,what) --intended use tbh
        if not eggs[what] then return 'No difference available for '..what end
        local diff = eggs[what] - self[what]
        if diff >= 0 then diff = '+'..tostring(diff):gsub("%-","") --[[for weird -0 thing]] end
        return tostring(diff)
    end
}) for i,v in pairs(eggs) do rawset(clone,i,v) end 

function fruits()
    local tbl = {
        ['Sunflower Seeds'] = {Index = 'SunflowerSeed', Value = eggs.SunflowerSeed},
        Strawberries = {Index = 'Strawberry', Value = eggs.Strawberry},
        Pineapples = {Index = 'Pineapple', Value = eggs.Pineapple},
        Blueberries = {Index = 'Blueberry', Value = eggs.Blueberry}
    }
    local retstr = ''
    for i,v in pairs(tbl) do
        retstr = retstr..string.format("%s: %s (%s)\n", i, tostring(v.Value),clone^v.Index)
    end
    
    return retstr:sub(1,-2)
end
function importants()
    local tbl = {
        Tickets = {Index = 'Ticket', Value = eggs.Ticket},
        Gumdrops = {Index = 'Gumdrops', Value = eggs.Gumdrops},
        Stingers = {Index = 'Stinger', Value = eggs.Stinger},
        ['Micro-Converters'] = {Index = 'Micro-Converter', Value = eggs['Micro-Converter']},
        ['Field Dice'] = {Index = 'FieldDice', Value = eggs.FieldDice}
    }
    local retstr = ''
    for i,v in pairs(tbl) do
        retstr = retstr..string.format("%s: %s (%s)\n", i, tostring(v.Value),clone^v.Index)
    end
    return retstr:sub(1,-2)
end

local final = {}
final.Fruits = fruits()
final.Special = importants()
--makepost(channel, constructfield(final))
--makepost(channel, constructfield({},16711680))

if getgenv().sock then pcall(function() getgenv().sock:Close() end) end
getgenv().sock = syn.websocket.connect('ws://localhost:3000')
local socket = getgenv().sock
function makepost(data) --makepost(constructfield{Name = function(), etc})
    if not socket.__OBJECT_ACTIVE then error('WebSocket is closed') end
    getgenv().sock:Send(json(data))
end
makepost{
    embeds = {
        constructfield{Fruits = fruits(), Special = importants()}
    }
    
}
game.OnClose = function()
    local final = {}
    final.Fruits = fruits()
    final.Special = importants()
    makepost{embeds = {constructfield(final, 16711680)}}
end