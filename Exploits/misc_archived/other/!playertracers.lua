_G.teamcheck = false
_G.togglechams = true
if game.CoreGui:FindFirstChild("DrawingTracers") then game.CoreGui.DrawingTracers:Destroy() end
if _G.drawtracers ~= nil then _G.drawtracers = not _G.drawtracers else do _G.drawtracers = true end end 
if _G.chams then for i,v in pairs(_G.chams) do v.ui:Destroy() end end
if _G.attachcham then _G.attachcham:Disconnect() end
local lp = game.Players.LocalPlayer
local camera = game.Workspace.CurrentCamera
local cc = workspace.CurrentCamera
_G.chams = {}
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "DrawingTracers"
local espgui = Instance.new("BillboardGui")
local esp = Instance.new("TextLabel",espgui)
espgui.ResetOnSpawn = true
espgui.AlwaysOnTop = true;
espgui.LightInfluence = 0;
espgui.MaxDistance = math.huge
espgui.Size = UDim2.new(1.75, 0, 1.75, 0);
espgui.SizeOffset = Vector2.new(0.5,-0.5)
esp.BackgroundColor3 = Color3.fromRGB(255, 255, 255);
esp.Text = ""
esp.Size = UDim2.new(0.0001, 0.00001, 0.0001, 0.00001);
esp.BorderSizePixel = 4;
esp.BorderColor3 = Color3.new(1,1,1)
esp.BorderSizePixel = 0
esp.Font = "GothamSemibold"
esp.TextSize = 14
esp.TextColor3 = Color3.new(1,1,1)
esp.Name = "Input"
esp.TextXAlignment = "Center"
esp.TextStrokeTransparency = 0
function billboardtrack(plr)
    
    local head = lp.Character and lp.Character:FindFirstChild("Head")
    local hrp = lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") or head
    local parttotrack = plr.Character and (plr.Character:WaitForChild("HumanoidRootPart", 5) or (plr.Character and plr.Character:WaitForChild("Head", 5)))
    if not parttotrack or not hrp then return end 
    local tracktype --0 for camera cframe, 1 for head cframe
    if (not head) and cc then
        tracktype = 0
        else if head then
            if (head.Position - cc.CFrame.Position).Magnitude <= 1 then
                tracktype = 0
                else do
                    tracktype = 1
                end
            end
        end
    end
    
    local bb
    if gui:FindFirstChild(plr.Name) then bb = gui[plr.Name] else do bb = espgui:Clone() bb.Name = plr.Name bb.Parent = gui bb.Adornee = parttotrack end end
        bb.Input.TextColor3 = plr.TeamColor.Color
    local distance = string.match(tostring((((tracktype == 1 and hrp.Position) or cc.CFrame.Position) - parttotrack.Position).Magnitude), "%d*")
    bb.Input.Text = string.format([[%s
%s studs
%s (%s%%)]], plr.Name, (distance or "?"),tostring((plr.Character:FindFirstChild("Humanoid") and plr.Character.Humanoid.Health) or 0):match("%d*"), tostring(plr.Character:FindFirstChild("Humanoid") and tostring((plr.Character.Humanoid.Health/plr.Character.Humanoid.MaxHealth)*100):match("%d*")) or "?")
    
end
local uienabled = true
function drawline(part, humanoid, plr) --2nd 3rd optional
    if part == nil then return end
    humanoid = ((typeof(humanoid) == "Instance") and humanoid:IsA("Humanoid") and humanoid) or nil
    if not part:IsA("BasePart") then return end
    local tracer = Drawing.new("Line")
    tracer.Visible = false
    tracer.Color = plr and ((plr.Character and (plr.Character:FindFirstChild("Dagger") or plr.Backpack:FindFirstChild("Dagger")) and Color3.new(1,0,0)) or plr.TeamColor.Color or Color3.new(1,1,1))
   tracer.Thickness = 1
   tracer.Transparency = 1
   local run
   run = game.RunService.RenderStepped:Connect(function()
        if humanoid.Health <= 0 or not part:IsDescendantOf(game) or not _G.drawtracers then run:Disconnect() tracer.Visible = false tracer = nil end 
        local vector, onscreen = cc:WorldToViewportPoint(part.Position)
        if onscreen and tracer then
           tracer.From = Vector2.new(cc.ViewportSize.X/2,cc.ViewportSize.Y/2)
           tracer.To = Vector2.new(vector.X,vector.Y)
            if _G.teamcheck and plr.TeamColor == lp.TeamColor then
               tracer.Visible = false
               if plr and gui:FindFirstChild(plr.Name) then gui[plr.Name].Enabled = false end
            else do
                if plr then tracer.Color = plr.TeamColor.Color end
                tracer.Visible = true
                tracer.Color = plr and ((plr.Character and (plr.Character:FindFirstChild("Dagger") or plr.Backpack:FindFirstChild("Dagger")) and Color3.new(1,0,0)) or plr.TeamColor.Color or Color3.new(1,1,1))
                if plr and gui:FindFirstChild(plr.Name) then gui[plr.Name].Enabled = true end
            end
            end
        else if tracer then
           tracer.Visible = false
           if plr and gui:FindFirstChild(plr.Name) then gui[plr.Name].Enabled = false end
        end
        end
        if plr then billboardtrack(plr) end
        if (not uienabled) and plr and gui:FindFirstChild(plr.Name) then gui[plr.Name].Enabled = false end
   end)

end

function trackplayer(plr)
    spawn(function()
        local pchar = plr.Character or plr.CharacterAdded:Wait()
        local part, h
        while not pcall(function()
            if not plr:IsDescendantOf(game) or not pchar:IsDescendantOf(game) then
                return 
            end 
            part = pchar.HumanoidRootPart
            h = pchar:FindFirstChildOfClass("Humanoid")
            return h.Health --does nothing just so both are satisfied 
        end) do wait() end
        drawline(part,h, plr)
    end)
    local addline
    addline = plr.CharacterAdded:Connect(function()
        if gui:FindFirstChild(plr.Name) then gui[plr.Name]:Destroy() end
        local pchar = plr.Character or plr.CharacterAdded:Wait()
        local part, h
        while not pcall(function()
            if not plr:IsDescendantOf(game) or not pchar:IsDescendantOf(game) then
                return 
            end 
            part = pchar.HumanoidRootPart
            h = pchar:FindFirstChildOfClass("Humanoid")
            return h.Health --does nothing just so both are satisfied 
        end) do wait() end
        drawline(part,h, plr)
        while _G.drawtracers do wait() end
        addline:Disconnect()
    end)
end
if not _G.drawtracers then return end
for i,v in pairs(game.Players:GetPlayers()) do
    if v == lp then continue end
    trackplayer(v)
end
function CreateSG(name,parent,face,player)
    local SurfaceGui = Instance.new("SurfaceGui",parent)
    SurfaceGui.Parent = parent
    SurfaceGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    SurfaceGui.Face = Enum.NormalId[face]
	SurfaceGui.LightInfluence = 0
	SurfaceGui.ResetOnSpawn = false
    SurfaceGui.Name = name
    SurfaceGui.AlwaysOnTop = true
    local Frame = Instance.new("Frame",SurfaceGui)
	Frame.BackgroundColor3 = Color3.fromRGB(85, 170, 255)
	Frame.Size = UDim2.new(1,0,1,0)
	table.insert(_G.chams, {ui = SurfaceGui, plr = player})
end

function makecham(plr)
    if not _G.togglechams then return end
    if not plr.Character then plr.CharacterAdded:Wait() end
    for i,v in pairs (plr.Character:GetChildren()) do
        if v == game.Players.LocalPlayer then continue end
        if v:IsA("MeshPart") or v.Name == "Head" then
            CreateSG("cham",v,"Back",plr)
            CreateSG("cham",v,"Front",plr)
            CreateSG("cham",v,"Left",plr)
            CreateSG("cham",v,"Right",plr)
            CreateSG("cham",v,"Right",plr)
            CreateSG("cham",v,"Top",plr)
            CreateSG("cham",v,"Bottom",plr)
        end
    end
end

game.Players.PlayerAdded:Connect(trackplayer)
_G.attachcham = game:GetService("UserInputService").InputBegan:Connect(function(what, chat)
    if not chat and what.KeyCode == Enum.KeyCode.T then
        uienabled = not uienabled
    end
end)