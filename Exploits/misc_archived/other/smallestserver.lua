--where did you go, friend?
--teleport to the smallest server in a game (or at least try to)

local HTTPS = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")


--self = game:HttpGet("https://raw.githubusercontent.com/michaeljwalla/luatools/main/pof_queue_recurse.lua")
--local queue = syn.queue_on_teleport or queue_on_teleport
local function tp(ignorelist)
    local nextCursor, serverId;
    local minimum, current = math.huge, math.huge;
    repeat
        local Servers;
        if not nextCursor then
            Servers = HTTPS:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/571353271/servers/Public?sortOrder=Asc&limit=100"))
        else
            Servers = HTTPS:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/571353271/servers/Public?sortOrder=Asc&limit=100&cursor="..nextCursor))
        end
    
        if (Servers) then
            nextCursor = Servers.nextPageCursor or nil
            for _,v in pairs(Servers.data) do
                v.playing = v.playing or 1/0
                if v.id == game.JobId then
                    current = v.playing
                elseif v.playing > minimum --[[and v.playing < current and]]and not ignorelist[minimum] then
                    minimum = v.playing
                    serverId = v.id
                end
            end
        end
        task.wait()
    until not nextCursor
    if (serverId) then
        printconsole("Teleporting to "..tostring(minimum).." Player Server!")
        TPS.TeleportInitFailed:Connect(function()
           printconsole("Failed... retrying")
           ignorelist[minimum] = true
           tp(ignorelist) 
        end)
        TPS:TeleportToPlaceInstance(game.PlaceId, serverId)
        
        return true
    else
        return false
    end
end
tp{}