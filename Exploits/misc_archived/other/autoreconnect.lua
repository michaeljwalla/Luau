repeat wait(0.1) until game:FindFirstChild"CoreGui" and game.CoreGui:FindFirstChild("RobloxPromptGui", true)
local tps = game:GetService("TeleportService")
local queue = syn and syn.queue_on_teleport or queue_on_teleport

if not isfile("disconnects.txt") then writefile("disconnects.txt", "") end
if isfile"rememberautoreconnect" then delfile"rememberautoreconnect" end

game.CoreGui.RobloxPromptGui:WaitForChild("promptOverlay").ChildAdded:Connect(function(v)
    if v.Name ~= 'ErrorPrompt' then return end
    print("Player disconnected")
    if not getgenv().autoreconnectscript then warn("No script was given, will not auto-reconnect.") return end

    appendfile("disconnects.txt", "DC/Kick at "..os.date()..'\n')
    
    print("Attempting to rejoin same server in 5s")
    delay(5, function() 
        writefile("rememberautoreconnect", "")
        local x
        x = tps.TeleportInitFailed:Connect(function()
            x:Disconnect()
            warn("Rejoin failed! Searching all servers...")
            queue(autoreconnectscript)
            loadfile("bell/lowestserv.lua")()
        end)

        queue(autoreconnectscript)
        tps:TeleportToPlaceInstance(game.PlaceId, game.JobId)
    end)
end)