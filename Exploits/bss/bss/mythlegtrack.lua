--script to find mythic and legendary puffshrooms (as the name suggests)

if game.CoreGui:FindFirstChild("puffs") then game.CoreGui.puffs:Destroy() return end --getting better with the re-run compatibility
local lp = game.Players.LocalPlayer
local mouse = lp:GetMouse()
local fieldtools = loadstring(game:HttpGet('https://pastebin.com/raw/vJGeNYjT'))() --library i made that just holds a bunch of field data (also unobfuscated)
local mythicval, legendval = game:GetService("ReplicatedStorage").BeeTypes.ColorMythic.Value, game:GetService("ReplicatedStorage").BeeTypes.ColorLegendary.Value --used to recolor ui objects when they flash
function draggable(inst,dragwhat) --a very terrible function i made that pops up a lot in my scripts as im too lazy to make another
    function mousePos()
        return {x = mouse.X, y = mouse.Y}
    end
    local start, curPos
    local movewithme
    inst.InputBegan:Connect(function(InputObject)
        if InputObject.UserInputType == Enum.UserInputType.MouseButton1 then
            movewithme = mouse.Button1Down:Connect(function()
                inst.BackgroundColor3 = Color3.new(1/8,1/8,1/8)
                start = mousePos()
                while task.wait() and movewithme.Connected do
                    curPos = mousePos()
                    menuLast = dragwhat.Position
                    if curPos.x ~= start.x or curPos.y ~= start.y then
                        dragwhat.Position = dragwhat.Position + UDim2.new(0,curPos.x - start.x,0, curPos.y - start.y)
                        start = mousePos()
                    end
                end
                inst.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
            end)
        end
    end)
    local mouseConnection
    mouseConnection = mouse.Button1Up:Connect(function()
        if not inst or not inst.Parent then mouseConnection:Disconnect() else do
            start = mousePos()
            curPos = start
            pcall(function()movewithme:Disconnect()end)
        end end
    end)
end
local main = Instance.new("ScreenGui", game.CoreGui)
main.Name = 'puffs'
local frame = Instance.new("TextLabel", main)
frame.Size = UDim2.new(0,300,0,300)
frame.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
draggable(frame, frame)
frame.Position = UDim2.new(0.5,200,0.5,-150)
frame.TextXAlignment = 'Left'
frame.TextYAlignment = 'Top'
frame.TextColor3 = Color3.new(1,1,1)
frame.Text = '    Legendary                             Mythic'
local legframe = Instance.new("ScrollingFrame", frame)
legframe.BackgroundColor3 = Color3.new(1/4,1/4,1/4)
legframe.Size = UDim2.new(0.5,0,1,-20)
legframe.Position = legframe.Position - UDim2.new(0,0,0,-20)
legframe.ScrollBarThickness = 2
legframe.CanvasSize= UDim2.new(0,0,0,0)
local mythframe = legframe:Clone()
mythframe.Parent = frame
mythframe.Position = mythframe.Position + UDim2.new(0,150,0,0)
legframe.ChildAdded:Connect(function()
    legframe.CanvasSize = UDim2.new(0,0,0,25*#legframe:GetChildren()) --uilistlayout whoops
end)
legframe.ChildRemoved:Connect(function()
    legframe.CanvasSize = UDim2.new(0,0,0,25*#legframe:GetChildren()) --uilistlayout whoops
    for i,v in pairs(legframe:GetChildren()) do
        v.Position = UDim2.new(0,0,0,25*(i-1))
    end
end)
mythframe.ChildAdded:Connect(function()
    mythframe.CanvasSize = UDim2.new(0,0,0,25*#mythframe:GetChildren()) --uilistlayout whoops
end)
mythframe.ChildRemoved:Connect(function()
    mythframe.CanvasSize = UDim2.new(0,0,0,25*#mythframe:GetChildren()) --uilistlayout whoops
    for i,v in pairs(mythframe:GetChildren()) do
        v.Position = UDim2.new(0,0,0,25*(i-1))
    end
end)
function newentry(where, data) --part of the puffshrooms.childadded connection, to add 
    local x = Instance.new("TextLabel", where)
    x.Name = data.Name
    x.Size = UDim2.new(0,125,0,25)
    x.Text = data.Text
    x.TextColor3 = Color3.new(1,1,1)
    x.TextSize = 12
    x.Position = UDim2.new(0,0,0,25*(#where:GetChildren()-1))
    x.BackgroundColor3 = Color3.new(1/3,1/3,1/3)
    data.Timer.Changed:Connect(function()
        x.Text = string.format('%s - %s', data.Level, data.Timer.Text:match("%d*:%d*$"))
    end)
    local y = Instance.new("ImageLabel", x)
    y.Position = y.Position + UDim2.new(0,125,0,0)
    y.Size = UDim2.new(0,25,0,25)
    y.BackgroundColor3 = Color3.new(1/3,1/3,1/3)
    y.Image = fieldtools.geticon(data.Field)
    return x
end
for i,v in pairs(game.Workspace.Happenings.Puffshrooms:GetChildren()) do
    local where
    if v.Name:find('Myth') then where = mythframe else if v.Name:find("Leg") then where = legframe end end
    if not where then continue end
    local body, lvl, time, ready
    while not (ready and wait()) do --waitfordescendant(s) but terrible
        ready = pcall(function()
            body = v['Puffball Top']
            lvl = body.Attachment.Gui.NameRow.TextLabel.Text:match('Lvl %d*')
            for i,v in pairs(body.Attachment.Gui:GetChildren()) do
                if v.Name == 'BarRow' and v.Bar.NumberLabel.Text:find('⌛') then
                    time = v.Bar.NumberLabel
                end
            end
        end)
    end
    local entry = newentry(where, {
        Name = v.Name,
        Level = lvl,
        Timer = time,
        Text = string.format('%s - %s', lvl, time.Text:match("%d*:%d*$")),
        Field = fieldtools.isin(body) --function from pastebin lib that returns what field a vector3 position would be inside of
    })
    v.AncestryChanged:Connect(function() entry:Destroy() end)
end
game.Workspace.Happenings.Puffshrooms.ChildAdded:Connect(function(v)
    local where
    if v.Name:find('Mythic') then where = mythframe else if v.Name:find("Legendary") then where = legframe end end
    print(where == mythframeaw) --i accidentally smashed my keyboard trying to re-tab into roblox and now there are wasds in my scripts (i removed most of them)
    if not where then return end
    local body, lvl, time, ready
    while not (ready and wait()) do --couldve been a function..
        ready = pcall(function()
            body = v['Puffball Top']
            lvl = body.Attachment.Gui.NameRow.TextLabel.Text:match('Lvl %d*')
            for i,v in pairs(body.Attachment.Gui:GetChildren()) do
                if v.Name == 'BarRow' and v.Bar.NumberLabel.Text:find('⌛') then
                    time = v.Bar.NumberLabel
                end
            end
        end)
    end
    local entry = newentry(where, {
        Name = v.Name,
        Level = lvl,
        Timer = time,
        Text = string.format('%s - %s', lvl, time.Text:match("%d*:%d*$")),
        Field = fieldtools.isin(body)
    })
    v.AncestryChanged:Connect(function() entry:Destroy() end)
    for i = 1, 3 do --flashing effect
        frame.BackgroundColor3 = ((where == mythframe) and mythicval) or legendval
        mythframe.BackgroundColor3 = ((where == mythframe) and mythicval) or legendval
        legframe.BackgroundColor3 = ((where == mythframe) and mythicval) or legendval
        wait(0.15)
        frame.BackgroundColor3 = Color3.new(1/6,1/6,1/6)
        mythframe.BackgroundColor3 = Color3.new(1/4,1/4,1/4)
        legframe.BackgroundColor3 = Color3.new(1/4,1/4,1/4)
        wait(0.15)
    end
end)
local con
con = game:GetService("UserInputService").InputBegan:Connect(function(input,chat)
    if not main.Parent then con:Disconnect() return end --not bad, self clean up
    if not chat and input.KeyCode == Enum.KeyCode.Backquote then frame.Visible = not frame.Visible end
end)
game.StarterGui:SetCore("SendNotification", {Title = 'hi', Text = 'backquote ` to hide/show'})