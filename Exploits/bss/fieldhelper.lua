local require = loadfile"bell/new/require.lua"""

local rs = game:GetService("ReplicatedStorage")

local shared = require"bell/new/shared"
local fztools = require(rs:WaitForChild"FlowerZoneTools")

local insert = table.insert
local max = math.max

local module = shared:Set("FieldHelper", {
	FieldLookup = {},
	FieldFlowers = {},
	Zones = {
		[0] = {1, 2, 3, 4, 5},
		[5] = {6, 7, 8},
		[10] = {9, 10},
		[15] = {11, 12, 13, 14},
		[25] = {15},
		[30] = {16, 17}
	},
	FieldMetadata = {}
})

local fieldnamesandids = module.FieldLookup
local fieldflowers = module.FieldFlowers
local fieldmetadata = module.FieldMetadata
do
	for i,v in next, workspace:WaitForChild"FlowerZones":GetChildren() do
		local name, id = tostring(v), v:WaitForChild"ID".Value
		local new = { Name = name, ID = id, Part = v }
		fieldnamesandids[name], fieldnamesandids[id] = new, new
		fieldflowers[id] = {}
		fieldmetadata[id] = {LenX = 0, LenZ = 0}
	end

	local IDXZ = {}
	local indx = 1
	local function insertnum(num: str): nil
		IDXZ[indx] = tonumber(num)
		indx = (indx % 3) + 1
	end

	for i,v in next, workspace:WaitForChild"Flowers":GetChildren() do
		tostring(v):gsub("%d+", insertnum) --add to list

		local fid, flowerX, flowerZ = unpack(IDXZ)
		insert(fieldflowers[fid], v)

		local md = fieldmetadata[fid]
		md.LenX = max(md.LenX, flowerX)
		md.LenZ = max(md.LenZ, flowerZ)
	end
end


function module:GetZoneInfo(identifier: string | number): { ID: number, Name: string }
	local info = fieldnamesandids[identifier]
	assert(info, "Attempt to get info for unknown field: "..tostring(identifier))
	return info
end
function module:GetZones()
	local new = {}
	for i,v in ipairs(fieldnamesandids) do insert(new, v) end
	return new
end
